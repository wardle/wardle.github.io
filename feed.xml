<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://www.wardle.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.wardle.org/" rel="alternate" type="text/html" /><updated>2023-09-29T17:50:25+01:00</updated><id>https://www.wardle.org/feed.xml</id><title type="html">Health informatics and information technology</title><subtitle>by Dr Mark Wardle, Consultant Neurologist and Chief Clinical Information Officer (CCIO)
</subtitle><entry><title type="html">NHS number validation and synthetic generation</title><link href="https://www.wardle.org/open-source/2023/09/29/nhs-number.html" rel="alternate" type="text/html" title="NHS number validation and synthetic generation" /><published>2023-09-29T17:16:16+01:00</published><updated>2023-09-29T17:16:16+01:00</updated><id>https://www.wardle.org/open-source/2023/09/29/nhs-number</id><content type="html" xml:base="https://www.wardle.org/open-source/2023/09/29/nhs-number.html"><![CDATA[<p>I’m pleased to announce the release of <a href="https://github.com/wardle/nhs-number">nhs-number</a>.</p>

<p>This is a very small open source library available for both server-side and client-side
use. It is written in Clojure/Script and so can be used, for example, on the JVM (servers) 
from Java or Clojure, or transpiled to JavaScript to be used in web browsers (clients).</p>

<p>In many domains, software developers make use of a range of foundational data and software 
services. They don’t need to re-invent the wheel; they’re focusing on getting to where they
need to go.</p>

<p>Things are so very different in healthcare.</p>

<p>Not only do you have to overcome fundamental problems with the commercial market failure for 
health and care software, byzantine procurement rules, as well as considering your information 
governance and regulatory compliance obligations, you have very few libraries and frameworks 
on which you can build your point of differentiation.</p>

<p>Of course, we have access to general purpose libraries, such as supporting secure networking
or encryption, or data storage. When we write software, whether for the web, or for iOS, or
Android, or Windows, we think about making use of a general purpose computing platform. It
is rare for us to build software without foundational core tools and services. Sometimes
those platforms are open-source, and sometimes those are proprietary, but they are available
and re-usable and composable so you can focus on the problems you are trying to solve.</p>

<p>But there is a dearth of high quality, well tested and functional libraries in health and care.</p>

<p><code class="language-plaintext highlighter-rouge">nhs-number</code> is a small library that:</p>

<ul>
  <li>is published under a permissive <a href="https://github.com/wardle/nhs-number/blob/main/LICENSE">open-source library</a> you can view and modify the source code</li>
  <li>has <a href="https://github.com/wardle/nhs-number/blob/main/test/com/eldrix/nhsnumber_test.cljc">extensive tests</a>, in including the use of synthetic (generative) tests</li>
  <li>has an <em>automated</em> continuous test/integration/deployment pipeline so that any modifications result in updated
tests and automated reports - e.g., see <a href="https://github.com/wardle/nhs-number/actions/runs/5916417398/job/16043690629">this report</a></li>
  <li>reports on <a href="https://app.codecov.io/gh/wardle/nhs-number">test coverage</a> automatically</li>
</ul>

<p>I already use it server-side for validation of data consumed from other services, and client-side to check user input is valid.
I also use it to generate synthetic data for automated tests in other systems.</p>

<p><em>Mark</em></p>]]></content><author><name></name></author><category term="open-source" /><summary type="html"><![CDATA[I’m pleased to announce the release of nhs-number.]]></summary></entry><entry><title type="html">Codelists</title><link href="https://www.wardle.org/strategy/2023/09/28/codelists.html" rel="alternate" type="text/html" title="Codelists" /><published>2023-09-28T10:09:09+01:00</published><updated>2023-09-28T10:09:09+01:00</updated><id>https://www.wardle.org/strategy/2023/09/28/codelists</id><content type="html" xml:base="https://www.wardle.org/strategy/2023/09/28/codelists.html"><![CDATA[<blockquote>
  <p>If a patient has a type of motor neurone disease, then…</p>
</blockquote>

<blockquote>
  <p>If a patient takes an ACE inhibitor, then …</p>
</blockquote>

<blockquote>
  <p>If a patient has a type of autoimmune disease, then …</p>
</blockquote>

<p>Whether we are writing software to build compelling user-facing applications, building rules or decision support,
or choosing categories from which we will run analyses such as understanding patient outcomes, we need to be able
to process health and care data and make inferences.</p>

<p>My open source software <a href="https://github.com/wardle/codelists">codelists</a> generates versioned codelists 
for reproducible data pipelines and research.</p>

<p>In general, there are two ways to think about codelists and reproducibility.</p>

<p>The first is a explicit human curation of a list of codes. This is the approach adopted by
Ben Goldacre and the <a href="http://opencodelists.org">opencodelists</a> team. You create and share codelists.</p>

<p>The second is to define a codelist using a declarative specification which can be
used to dynamically - but reproducibly - generate the codelist.</p>

<p>Let’s look at an example. <a href="http://opencodelists.org">opencodelists</a> has a codelist
to specify terms that represent a referral to colorectal services under a 2-week wait
(urgent) basis. See <a href="https://www.opencodelists.org/codelist/phc/2ww-referral-colorectal/7eac259d/#full-list">https://www.opencodelists.org/codelist/phc/2ww-referral-colorectal/7eac259d/#full-list</a></p>

<p>At the time of writing, this manually curated list includes one active concept and
two inactive concepts.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>276401000000108	Fast track referral for suspected colorectal cancer
276411000000105	Urgent cancer referral - colorectal
276421000000104	Urgent cancer referral - colorectal
</code></pre></div></div>

<p>While this is a useful set of curated terms, I would argue that it is better to simply 
define this codelist using a SNOMED CT constraint using the syntax of the SNOMED CT 
expression constraint language:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "ecl": "&lt;&lt;276401000000108"
} 
</code></pre></div></div>
<p>Result:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=&gt; #{276401000000108 276411000000105 276421000000104}
</code></pre></div></div>

<p>Based on a named versioned distribution of SNOMED, and defined versions of this
tool, this specification can be used to generate a reproducible codelist. If SNOMED CT
changes over time, this specification will continue to work, due to the semantic
relationships within SNOMED CT. <code class="language-plaintext highlighter-rouge">codelists</code> can expand a set of codes to include
now inactive concepts using historical associations.</p>

<p>Certainly for drugs, a declarative rules approach works better than the manually
curated set of opencodelists. If new drugs of a type are added to the UK dictionary
of medicines and devices (dm+d), then <code class="language-plaintext highlighter-rouge">codelists</code> will include those new drugs
without any manual intervention, while manual curation requires continued
monitoring and maintenance of code lists.</p>

<h1 id="how-to-use-codelists">How to use <code class="language-plaintext highlighter-rouge">codelists</code></h1>

<p>You can define codelists using a variety of means, such as</p>

<ul>
  <li>ICD-10 codes for diagnoses</li>
  <li>ATC codes for drugs</li>
  <li>SNOMED CT expressions in the expression constraint language (ECL).</li>
</ul>

<p>You can combine these approaches for high sensitivity, or manually derive codelists using hand-crafted ECL for high
specificity.</p>

<p><code class="language-plaintext highlighter-rouge">codelists</code> is a simple wrapper around two other services - <a href="https://github.com/wardle/hermes">hermes</a>
and <a href="https://github.com/wardle/dmd">dmd</a>. I think it is a nice example of composing discrete, but related services
together to give more advanced functionality.</p>

<p><code class="language-plaintext highlighter-rouge">codelists</code> operates:</p>

<ul>
  <li>as a library and so can be embedded within another software package running on the java virtual machine (JVM), written
in, for example java or clojure.</li>
  <li>as a microservice and so can be used as an API by other software written in any language</li>
</ul>

<p>The substrate for all codelists is SNOMED CT. That coding system is an ontology and terminology, and not simply a
classification. That means we can use the relationships within SNOMED CT to derive more complete codelists.</p>

<p>If you only use the SNOMED CT ECL to define your codelists, then simply use <code class="language-plaintext highlighter-rouge">hermes</code> directly.
You only need the additional functionality provided by <code class="language-plaintext highlighter-rouge">codelists</code> if you are building codelists
from a combination of SNOMED CT ECL, ATC codes and ICD-10.</p>

<p>ATC maps are not provided as part of SNOMED CT, but are provided by the UK
dm+d. ICD-10 maps are provided as part of SNOMED CT.</p>

<h1 id="using-codelists">Using codelists</h1>

<p>You can <em>realise</em> a codelist, expanding it to all of its codes. You can also test membership of a given code against a
codelist.</p>

<p>All codelists, by default, expand to include historic codes. This will become
configurable, but is the default for greater sensitivity at the expense of specificity.
Different trade-offs might apply to your specific project.</p>

<p>Boolean logic is supported, with arbitrary nesting of your codes using a simple DSL.</p>

<p>A codelist is defined as names and values in a map, with the names representing the codesystem
and the values the specification.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;&lt;24700007"</span><span class="w">
</span><span class="p">}</span><span class="w"> 
</span></code></pre></div></div>

<p>This defines a codelist using the SNOMED expression constraint language (ECL). While ECL v2.0 supports the use of
historic associations within constraints, I usually recommend ignoring that ‘feature’ and instead defining whether and
how historic associations are included as part of the API.</p>

<p>SNOMED CT, in the UK, includes the UK drug extension with a 1:1 map between SNOMED identifiers and drugs in the official
UK drug index - dm+d
(dictionary of medicines and devices). That means you <em>can</em> use a SNOMED expression to choose drugs:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(&lt;&lt;24056811000001108|Dimethyl fumarate|) OR (&lt;&lt;12086301000001102|Tecfidera|) OR (&lt;10363601000001109|UK Product| :10362801000001104|Has specific active ingredient| =&lt;&lt;724035008|Dimethyl fumarate|)"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note how SNOMED ECL includes simple boolean logic.</p>

<p>But `codelists’ supports other namespaced codesystems. For example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX07"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Will expand to a list of SNOMED identifiers that are mapped to the exact match ATC code L04AX07 and its descendents
within the
SNOMED hierarchy.</p>

<p>A SNOMED CT expression in the expression constraint language must be a valid expression.
ICD-10 and ATC codes can be specified as an exact match (e.g. “G35”) or as a prefix (e.g. “G3*”). The latter will
match against all codes that begin with “G3”.</p>

<p>Different codesystems can be combined using boolean operators and prefix notation:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"or"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX07"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX08"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(&lt;10363601000001109|UK Product| :10362801000001104|Has specific active ingredient| =&lt;&lt;724035008|Dimethyl fumarate|)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This expands the ATC codes L04AX07 L04AX08 and supplements with any other product containing DMF as its active
ingredient.</p>

<p>If multiple expressions are used, the default is to perform a logical OR. That means this is equivalent to the above
expression:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX07"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX08"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(&lt;10363601000001109|UK Product| :10362801000001104|Has specific active ingredient| =&lt;&lt;724035008|Dimethyl fumarate|)"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Duplicate keys are <em>not</em> supported, but multiple expressions using different keys are.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L04AX07"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(&lt;10363601000001109|UK Product| :10362801000001104|Has specific active ingredient| =&lt;&lt;724035008|Dimethyl fumarate|)"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>When no operator is explicitly provided, a logical ‘OR’ will be performed.</p>

<p>For concision, all keys can take an array (vector), which will be equivalent to using “or” using the same codesystem.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"L04AX07"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"L04AX08"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Boolean operators “and”, “or” and “not” can be nested arbitrarily for complex expressions.</p>

<p><code class="language-plaintext highlighter-rouge">codelists</code> also supports ICD-10.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"icd10"</span><span class="p">:</span><span class="w"> </span><span class="s2">"G35*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>will expand to include all terms that map to an ICD-10 code with the prefix “G35”, and its descendents.</p>

<p>The operator “not” must be defined within another term, or set of nested terms. The result will be the realisation of
the first term, or set of nested terms, MINUS the realisation of the second term, or set of nested terms.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"icd10"</span><span class="p">:</span><span class="w"> </span><span class="s2">"G35"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"not"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;24700007"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Or, perhaps a more complex expression:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"or"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"icd10"</span><span class="p">:</span><span class="w"> </span><span class="s2">"G35"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"icd10"</span><span class="p">:</span><span class="w"> </span><span class="s2">"G36.*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"not"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;24700007"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Or, more concisely:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"icd10"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"G35"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"G36.*"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"not"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ecl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;24700007"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>These will generate a set of codes that includes codes “G35” and any with the prefix “G36.” but omit “24700007” (
multiple sclerosis).</p>

<p>You can use wildcards. Here I directly use a running <code class="language-plaintext highlighter-rouge">codelists</code> HTTP server
to expand a codelist defined as</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"atc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C08*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This should give a codelist containing all calcium channel blockers.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="s1">'127.0.0.1:8080/v1/codelists/expand?s={"atc":"C08*"}'</span>
</code></pre></div></div>

<p>Result:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="mi">374049007</span><span class="p">,</span><span class="w">
  </span><span class="mi">13764411000001106</span><span class="p">,</span><span class="w">
  </span><span class="mi">376841009</span><span class="p">,</span><span class="w">
  </span><span class="mi">11160711000001108</span><span class="p">,</span><span class="w">
  </span><span class="mi">893111000001107</span><span class="p">,</span><span class="w">
  </span><span class="mi">29826211000001109</span><span class="p">,</span><span class="w">
  </span><span class="mi">376754006</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>You can customise how data are returned.</p>

<p>By default, a list of codes is returned.</p>

<p>To return identifier and name, use ‘as=names’</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="s1">'127.0.0.1:8080/v1/codelists/expand?s={"atc":"C08*"}&amp;as=names'</span>
</code></pre></div></div>

<p>Result:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">374049007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nisoldipine 20mg tablet"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">13764411000001106</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Amlodipine 5mg tablets (Apotex UK Ltd)"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">376841009</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Diltiazem malate 120 mg oral tablet"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11160711000001108</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Exforge 10mg/160mg tablets (Novartis Pharmaceuticals UK Ltd)"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">893111000001107</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tildiem LA 300 capsules (Sanofi)"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>For reproducible research, <code class="language-plaintext highlighter-rouge">codelists</code> will include information about <em>how</em> the codelist was generated, including the
releases of SNOMED CT, dm+d and the different software versions. It should then be possible to reproduce the content of
any codelist. At the moment, only the data versions are returned:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http 127.0.0.1:8080/v1/codelists/status
</code></pre></div></div>

<p>The following metadata will be returned:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"dmd"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"releaseDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-05-05"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hermes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"© 2002-2021 International Health Terminology Standards Development Organisation (IHTSDO). All rights reserved. SNOMED CT®, was originally created by The College of American Pathologists. </span><span class="se">\"</span><span class="s2">SNOMED</span><span class="se">\"</span><span class="s2"> and </span><span class="se">\"</span><span class="s2">SNOMED CT</span><span class="se">\"</span><span class="s2"> are registered trademarks of the IHTSDO."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"32.12.0_20220413000001 UK drug extension"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"32.12.0_20220413000001 UK clinical extension"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>]]></content><author><name></name></author><category term="strategy" /><summary type="html"><![CDATA[If a patient has a type of motor neurone disease, then…]]></summary></entry><entry><title type="html">Unbundling the electronic health record</title><link href="https://www.wardle.org/strategy/2022/12/02/functional-health-records.html" rel="alternate" type="text/html" title="Unbundling the electronic health record" /><published>2022-12-02T14:14:14+00:00</published><updated>2022-12-02T14:14:14+00:00</updated><id>https://www.wardle.org/strategy/2022/12/02/functional-health-records</id><content type="html" xml:base="https://www.wardle.org/strategy/2022/12/02/functional-health-records.html"><![CDATA[<p>This is a <a href="https://youtu.be/2HQSAtmVbAU?si=97TfdaCc1Wwbq6Dk">talk I gave at the re-Clojure 22 technology conference in December 2022</a>:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/2HQSAtmVbAU?si=NWX55fL27rvi5HdD" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<p>Clojure is a programming language that is a dialect of Lisp, but none of the concepts here require the use of Clojure as
a programming language. Rather, this talk is more about learning from some of
the principles behind Clojure, and functional programming languages generally,
and internet-era software architectural design, to re-imagine the software we use in health and care.</p>

<h2 id="introduction">Introduction</h2>

<p><img src="/images/unbundling/unbundling.001.png" alt="title" /></p>

<p>In this blog post, I argue that we must transform the way we perceive and use electronic health records (EHRs).
By employing the principles of Clojure and reimagining the EHR, we have the potential to turn this essential tool inside
out, unlocking its full potential, and support a health and care system designed around the needs of patients and
professionals.</p>

<h2 id="traditional-ehr-vs-inside-out-thinking">Traditional EHR vs inside-out thinking</h2>

<p><img src="/images/unbundling/unbundling.002.png" alt="unbundling" /></p>

<p>To begin, let’s understand the traditional or conventional Electronic Health Record (EHR). Typically, an EHR is
considered an application or system that healthcare providers purchase, deploy, and often integrate with other systems.
These EHRs are organization-centric, designed to meet the needs of the purchasing entity, and are heavily focused on
process and billing. They tend to be monolithic, with proprietary internals and limited interoperability within the
product. Interoperability is considered ‘external’.</p>

<p>In essence, EHRs are like isolated islands in the digital healthcare landscape, making integration complex and resulting
in data concretions within an enterprise. Patient data is contained within these applications, making it challenging to
use the same data for different purposes like population health analytics, service management, and research.
Furthermore, the tooling used for EHRs differs significantly from what is required for analytics and research.
For example, we may use Python or R for research, proprietary tools for analytics in managing services,
and very different tools for applications supporting direct care.</p>

<h2 id="unbundling-the-ehr">Unbundling the EHR</h2>

<p>The concept of unbundling the EHR involves shifting the focus from the organization to the patient and adopting the FAIR
principles: findability, accessibility, interoperability, and reusability. In this model, data becomes the central
element, with the potential for easy composition of data from multiple organizations, regardless of their origin. This
shift allows us to move beyond process measures to more meaningful outcomes in healthcare.</p>

<p>By concentrating on data, the architecture inherently becomes distributed, similar to how we build external systems.
This approach is inspired by Rich Hickey’s concept of using plain data, RPC, and queues in system architecture. The
result is a suite of independent but composable computing and data services, both internally and externally
interoperable. These services provide flexibility, adaptability, and scalability, aligning with the dynamic nature of
healthcare.</p>

<p>We must move to a domain-driven design in health care.</p>

<h2 id="interoperability">Interoperability</h2>

<p><img src="/images/unbundling/unbundling.003.png" alt="interoperability" /></p>

<p>In healthcare, interoperability has been a long-standing challenge. Various approaches, such as convergence through
shared applications or information exchanges, have been attempted. However, these approaches often fall short,
especially in supporting granular analytics and research.</p>

<p>A more effective solution is to approach interoperability through <em>composition and layering of domain-aligned data and
software components</em>. Instead of forcing organizations to adopt a single shared application, the focus shifts to
standardized data exchange. This enables the creation of shared care records that may not contain all the detail but are
sufficient for many purposes.</p>

<h2 id="domain-centric-approach">Domain-Centric Approach</h2>

<p><img src="/images/unbundling/unbundling.004.png" alt="Domain-driven design" /></p>

<p>Breaking down the EHR into its domain-specific components can provide clarity and facilitate meaningful, semantic
interoperability. Components related to radiology, staff, patients, reference data, classifications, and terminology
can be understood and managed individually across organisational boundaries. It is seductive to think that a single
system can do all that we need, but health and care is too complex and needs to be broken up into smaller, manageable
chunks which can be developed and improved independently.</p>

<p><img src="/images/unbundling/unbundling.005.png" alt="Shared semantics" /></p>

<p>An approach predicated upon organisations and not health and care domains creates fragmentation and loss of shared
semantics. Traditional EHRs often adopt the shared single instance approach or attempt to converge various systems.
However, this
can lead to fragmentation and a lack of shared semantics. Unbundling the EHR, on the other hand, enables data to flow
seamlessly and allows for dynamic composition of services, resulting in a more cohesive and flexible healthcare
ecosystem.</p>

<p>For example, an organisation-focus means that a staff member who works across multiple sites may need multiple logins
and find it difficult to generate a report detailing all of the surgical procedures performed across those sites, as
there may not be shared understanding of the identifiers that underpin that staff member. If they are a prescriber, each
organisation must be careful to register their accounts so that they have access to e-prescribing.</p>

<p>Instead, we should be recognising the importance of domain-boundaries, and that a staff index, and associated data
such as scope of practice, and regulatory informaion, is a first-class, important domain within health and care; likely
needing federation and aggregation of a number of disparate sources of information, but presented as a unified, and
simpler service to other domain components.</p>

<h2 id="turning-electronic-health-and-care-records-inside-out">Turning electronic health and care records inside-out</h2>

<p>What can we learn from Clojure?</p>

<p><img src="/images/unbundling/unbundling.006.png" alt="Learning from Clojure" /></p>

<p>While Clojure is an excellent language to implement the software for the next
generation of electronic health record systems, we can learn the most from the principles
that underpin the design of Clojure:</p>

<ul>
  <li>Data-orientated</li>
  <li>First class names</li>
  <li>Working to abstractions</li>
  <li>Functional / pure functions / reproducibility</li>
  <li>Immutability</li>
  <li>Loose coupling</li>
  <li>Dynamic / flexible / adaptive to change</li>
  <li>First class events / event modelling</li>
  <li>Building the internals of our systems as in the large (Internet-era approach)</li>
</ul>

<p>Using these principles, we can look towards interoperability through <strong>composition and layering
of domain-orientated data and software components</strong>.</p>

<h3 id="example--thinking-about-analytics-for-electronic-prescribing">Example : thinking about analytics for electronic prescribing</h3>

<p><img src="/images/unbundling/unbundling.007.png" alt="e-prescribing" /></p>

<p>Imagine a scenario: You’re in a hospital, and you need to closely monitor all the antibiotics being prescribed to
patients. It’s a critical task that can impact patient outcomes, but it’s also one that can be quite complex due to the
diverse nature of healthcare systems.</p>

<p><strong>Option 1: Leveraging In-Built Analytics</strong></p>

<p>The first option is to rely on the built-in analytics tools provided by EPMA (electronic prescribing and medicines
administration)
or Electronic Patient Records (EPR) vendors. These tools are designed to work seamlessly within their respective
systems, offering insights
and analytics specific to that environment. While this option can be effective within the confines of a single system,
it falls short when dealing with the intricate web of healthcare data spread across different platforms.</p>

<p>In the real world, many hospitals use different prescribing systems, each tailored to a specific aspect of patient care.
For instance, chemotherapy prescribing systems differ significantly from those used for general medical purposes.
Moreover, various healthcare enterprises, including community services and general practitioner surgeries, operate on
different systems altogether. This fragmentation poses a significant challenge when aiming for a comprehensive,
population-level analysis of healthcare data.</p>

<p><strong>Option 2: Embracing Health Information Exchanges</strong></p>

<p>The second approach involves aggregating data from various sources into a Health Information
Exchange (HIE). An HIE acts as a bridge between disparate healthcare systems, allowing data to flow between them. While
this approach can provide a degree of standardization and interoperability, it doesn’t fully address the underlying
issues of data granularity and accessibility. In essence, it’s a step in the right direction but may not be the ultimate
solution for comprehensive healthcare data analysis.</p>

<p><strong>Option 3: Unbundling Electronic Health Records (EHRs)</strong></p>

<p>Now, here’s where unbundling the Electronic Patient Record (EPR) or Electronic Health Record (EHR) system comes in.
In simple terms, this means taking the data generated by these systems, transforming it into a standardized,
self-describing event stream, and making it accessible for a wide range of applications, including direct-care (e.g.
alerts),
analytics (a dashboard of all antimicrobials across an estate), and research.</p>

<p>This unbundling process begins with extracting data from these systems. While many suppliers can provide data feeds in a
standardized format, some may require transformation and extraction to create a consistent event stream. Once achieved,
this event stream becomes a valuable resource for healthcare professionals.</p>

<p><strong>The Power of Data Annotation</strong></p>

<p>To maximize the utility of this event stream, we must recognise the importance of data annotation. This involves
enriching the data with additional information using terminology and drug dictionaries. For instance, a healthcare
provider can perform lookups against drug codes in the event stream, providing meaningful insights about the medications
prescribed. We must recognise that mapping and annotations are first-class problems in our domain, and those tools
should be available on demand, for a range of use-cases, and independent from individual vendors.</p>

<p>These annotated event streams can then be divided into substreams, each tailored to specific aspects of patient care.
For example, an antimicrobial event stream can be created and used to populate a real-time dashboard, enabling
healthcare providers to monitor antibiotic usage and make informed decisions promptly.</p>

<p><strong>Transforming Healthcare Data Management</strong></p>

<p>In essence, the vision revolves around turning the traditional approach to EHRs inside out. Instead of
relying solely on monolithic EHR systems, healthcare institutions should be able to embrace the power of first-class, composable data
and software services. This shift would allow for dynamic data composition and interoperability spanning organizational
boundaries, ultimately benefiting patient care, analytics, and research.</p>

<p>As healthcare continues to evolve, the ability to harness and analyze data effectively becomes paramount. By breaking
down data silos, enhancing interoperability, and making data truly first-class, the healthcare industry can take
significant strides
toward improved patient outcomes and a more efficient healthcare system. It’s a journey that requires effort and
collaboration and a foundation of vendor-neutral, and open, data and computing services.</p>

<h1 id="first-class-annotation-and-mapping">First-class annotation and mapping</h1>

<p><img src="/images/unbundling/unbundling.008.png" alt="terminology" /></p>

<p>In the world of healthcare and patient care, one of the most crucial aspects is the ability to <strong>make sense</strong> of the vast
and ever-evolving landscape of health and care data. This requires the use of standardized terminologies, and one example 
is SNOMED CT. Driven by the need for dynamic and adaptable software systems, we need ubiquitous tooling that harnesses 
the potential of SNOMED CT in healthcare, providing access to its power in any application, for any purpose.</p>

<p>For example, we can standardise on vocabularies, such as the list of specialty codes. However, such an approach leads
to concretions in our software systems, because if the master list of codes is updated, any software that needs to make
sense of those codes needs to be updated. In addition, these codes are usually not self-describing, or contain 
information about the relationships between those codes.</p>

<p>Instead, an ontology provides rich semantics supporting inference and sense-making.</p>

<p>For example, imagine I wish to build a compelling user experience so that a user can rapidly search for correspondence
relating to a speciality. If I have a flat list of codes, ‘neurology’ and ‘paediatric neurology’ are considered 
independent specialties, and if I wish to allow users to search for ‘paediatrics’ and also include ‘paediatric neurology’
then I must build those kinds of rules outside of my vocabulary / classification list.</p>

<p>A more dynamic and flexible approach such as that enabled by SNOMED CT might allow a user to choose ‘neurology’ and find 
letters for all types and subtypes of ‘neurology’ as a specialty, which would, of course, include ‘paediatric neurology’ 
by virtue of the ontological basis underpinning SNOMED CT. While some might think that this a dry and academic subject,
by getting our foundations right, we make it easier to build compelling, and delightful user experiences.</p>

<p>I’ve open-sourced a number of libraries and services that can support this kind of work:</p>

<ul>
  <li><a href="https://github.com/wardle/hermes">https://github.com/wardle/hermes</a> - SNOMED CT library and web service</li>
  <li><a href="https://github.com/wardle.codelists">https://github.com/wardle/codelists</a> - Generate code lists via declarative rules</li>
  <li><a href="https://github.com/wardle/dmd">https://github.com/wardle/dmd</a> - UK drug dictionary</li>
  <li><a href="https://github.com/wardle/hades">https://github.com/wardle/hades</a> - HL7 FHIR terminology wrapper around hermes</li>
</ul>

<p>This work should be open-source and available widely, and used for many different purposes, including direct care,
analytics pipelines and research. Such libraries and tools need to be quick to set-up and use, and not require 
significant investments in infrastructure or server capacity. It makes little sense to not share foundational software 
services. It is otherwise akin to developers needing to start by building their own encryption libraries; no-one should do that 
but instead use open, readily available and battle-tested ready-made libraries.</p>

<h1 id="mapping-and-projections-are-first-class-problems-in-our-domain">Mapping and projections are first-class problems in our domain</h1>

<p>We need to recognise, and therefore provide compelling, battle-tested solutions to first-class problems in our domain. 
Recognising the issues forces use to focus our limited resources on things that have the greatest benefit. If we think
that building user interfaces is the biggest issue, then we spend our time (erroneously) building solutions for e-forms.
Instead, if we recognise the true (shared) challenges, then we should quickly see that semantic interoperability depends
fundamentally on data and software that can make sense of, and map between different ways of encoding health and care 
data.</p>

<p><img src="/images/unbundling/unbundling.011.png" alt="data projections" /></p>

<p>Here we see that, for a specific research project, I’ve taken complex, real-life hierarchical and nested health data and
generated a simplifed <strong>rectangular projection</strong> to make it easier for subsequent analysis. Fundamentally, the projections
will vary depending on context and use-case, so we must focus on capturing highly granular and specific data at the point
of care, while building tools and chains and data pipelines that permit turning that specific data into a variety of
formats convenient for the use-case at hand. Importantly, we delay the loss of granular information until as late a 
stage as possible. Too many times, we look to ask professionals to record categorical data in order to simplify subsequent use of
those data, rather than capturing data at the right level of granularity for clinical use, and making use of the right tools,
and right expertise, to classify those data later on according to the need at hand. We should derive those projections.</p>

<p>Here is an overview of some of the tools I have built so far, in my spare time.</p>

<p><img src="/images/unbundling/unbundling.012.png" alt="tools" /></p>

<p>My current focus has been on lower-level, fundamental software and data services. However the future should be that we
build an ecosystem of composable higher-value components, well-tested and built by community efforts, relating to design 
systems and decision support. Why are we building prescribing rules in proprietary software systems when the community
could be building in the open to be used for whatever purpose necessary?</p>

<p><img src="/images/unbundling/unbundling.013.png" alt="graph api" /></p>

<p>Finally, I’ve recognised that one way of composing together data and software services within health and care is through
the use of graph APIs. Such APIs allow one to seamlessly navigate across disparate data services permitting user-facing
applications to be built independently of the the underlying software and data subsystems resolving the queries at hand.</p>

<p>In the video, I give a demonstration of using Hermes from a Clojure REPL, permitting interactive programming. For example,
I show how I can build a data pipeline that takes diagnostic and problem codes and map them into a specific emergency reference
set (subset) to simplify analysis.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In conclusion, the concept of unbundling the EHR and adopting Clojure-derived principles has the potential to
transform healthcare data management. By focusing on data, achieving interoperability, and leveraging standardized
terminologies, we can create a more flexible, adaptable, and patient-centric healthcare ecosystem. This approach not
only benefits direct patient care but also empowers analytics and research, ultimately leading to better outcomes in the
healthcare industry.</p>]]></content><author><name></name></author><category term="strategy" /><summary type="html"><![CDATA[This is a talk I gave at the re-Clojure 22 technology conference in December 2022:]]></summary></entry><entry><title type="html">Mapping the electronic health record 2/2</title><link href="https://www.wardle.org/strategy/2021/12/14/mapping-the-epr-2.html" rel="alternate" type="text/html" title="Mapping the electronic health record 2/2" /><published>2021-12-14T14:14:14+00:00</published><updated>2021-12-14T14:14:14+00:00</updated><id>https://www.wardle.org/strategy/2021/12/14/mapping-the-epr-2</id><content type="html" xml:base="https://www.wardle.org/strategy/2021/12/14/mapping-the-epr-2.html"><![CDATA[<p>This is part 2/2 of my presentation at <a href="https://www.map-camp.com">MapCamp 2021</a>.</p>

<p><img src="/images/mapcamp21/map-ehr.001.png" alt="Title page" /></p>

<p>You can <a href="https://www.youtube.com/watch?v=9Vk6bg0uk4o">watch a video recording</a> of that presentation if you like, but
this post is a
deeper dive into some of the detail.</p>

<h1 id="2-algorithms">2. Algorithms</h1>

<p>So what about algorithms, and machine learning in health and care? Are you sure machines need anything different to what
we as humans need?</p>

<p><img src="/images/mapcamp21/map-ehr.007.png" alt="The need for interoperability" /></p>

<p>I’ve
previously <a href="https://wardle.org/strategy/2018/08/30/algorithm-strategy.html">drawn Wardley maps for the use of algorithms and machine learning in healthcare</a>:</p>

<p><img src="/images/mapcamp21/map-ehr.008.png" alt="The need for interoperability" /></p>

<p>There’s a complete <a href="https://wardle.org/strategy/2018/08/30/algorithm-strategy.html">blog post</a> about it, if you want
more detail.</p>

<p>But, you’ll see that whether you are looking to support a new clinical score that calculates stroke risk, or a new
machine learning algorithm that can interpret chest x-rays, computers need the same types of information and support and
feedback loops and monitoring as do professionals and services and facilities.</p>

<p>Our Wardley map shows dependencies on:</p>

<ul>
  <li>meaningful data</li>
  <li>feedback looks</li>
  <li>monitoring and evaluation pipelines</li>
  <li>consent and control</li>
  <li>readily available tools and libraries</li>
</ul>

<p><img src="/images/mapcamp21/map-ehr.011.png" alt="Machines vs humans" /></p>

<hr />

<h1 id="what-do-we-currently-have">What do we currently have?</h1>

<p>This map looks at the electronic health record from the viewpoint of an organisation, because that’s the usual model of
how software used in health and care, whether for acute hospitals or community services.</p>

<p><img src="/images/mapcamp21/map-ehr.013.png" alt="The need for interoperability" /></p>

<p>In this map, I show a dependency from the organisation to an electronic patient record.</p>

<p><em>NB: I think that dependency and mapping from organisation to health record can and should be challenged. A patient
shouldn’t have to know that one specialist service is managed by that organisation and another from another; aren’t they
interacting with a health service that should feel seamless? They should not need to know organisational or department
structures. We need to move to a single logical patient record, even if that record is aggregated or federated from
multiple providers.</em></p>

<p>Many organisations have bought off-the-shelf electronic health record products. As part of that, they might also buy,
usually but not always from the same supplier, the following products:</p>

<ul>
  <li>a patient portal - to allow patients to interact with, or at least view their record, at that organisation</li>
  <li>population analytics - to allow analytics across groups of patients</li>
  <li>health information exchange - to share data between organisations in, for example, a region</li>
  <li>an API product - to allow developers to build products using the data and services within the EPR.</li>
</ul>

<p>An API is an “application programming interface” - in essence a way for systems or subsystems or modules of software to
communicate.</p>

<p>You’ll see from the map that the API product is usually dependent on the EHR in this model. We’re going to need to
challenge that, because health and care records should surely be built using open APIs, not the other way around?</p>

<p>How can it be that our APIs our dependent on the EPR, rather than our EPR being dependent on our APIs?</p>

<p>In addition, the organization wants to share data across a region so they buy the product’s linked health information
exchange (HIE) product. This means that they can exchange data with other hospitals and other organizations within that
region.</p>

<p>But far from reducing the need for in-house development capacity, the need for integration and customisation means many
organisations embarking on their EPR journey end up increasing the numbers of in-house developers. The EPR, costing
rather a lot of money, hasn’t really solved all of our problems at all, and what we think of as research remains
entirely separate. It is akin to thinking we’ve bought an ‘off-the-shelf’ suit, but actually needing to do a significant
amount of tailoring ourselves.</p>

<p>Importantly, spending this money on an EPR does not prevent us having to do some real work on proper collaboration and
cooperation across health and care whether it be for direct patient care, service management, improvement, monitoring or
research, for otherwise we still end up with data silos in which we cannot easily pool data. Indeed, we surely need to
prioritise that work rather than thinking we can defer until after our EPR deployment?</p>

<h1 id="dependencies-and-tell-me-again-why-are-we-building-our-own-data-centres">Dependencies, and tell me again why are we building our own data centres?</h1>

<p>Our map also shows us that our in-house development, our EPR, our analytics platform, our health information exchange,
and patient portal(s) need infrastructure on which to run such as ‘compute’ and ‘data’ services. However, the map shows
that health systems still have significant legacy services that are bespoke and proprietary and custom-built, instead of
recognising that, particularly with limited local resource, we should be focusing on the things only the public sector
can do, and using off-the-shelf infrastructure on demand.</p>

<p>The big technology companies have so far pretty much failed in healthcare. I give them a D- “Could do better”.</p>

<p><img src="/images/mapcamp21/map-ehr.014.png" alt="Technology companies have failed" /></p>

<p>They’re fixated on infrastructure, particularly cloud services. Apple is an exception with its Apple Health app serving
as a patient portal.</p>

<p>The fundamental question for electronic health records (EHRs) is whether to buy from one vendor or assemble a
best-of-breed system, both of which can lead to complexity, particularly if we use point-to-point integration patterns
rather than a common shared platform. Buying the components from a single vendor, or integrating best-of-breed can result 
in a fossilised architecture which is difficult to change, proving to be inflexible and difficult to adapt to changing 
requirements. There can be a combinatorial explosion unless we build a platform on which disparate applications and 
services can sit.</p>

<p><img src="/images/mapcamp21/map-ehr.015.png" alt="Component parts of the EHR" /></p>

<p>Finally, we should also ask why are healthcare data for analysis, research and direct care kept separate? They should be
integrated for better patient care, with the same data used for multiple purposes. For example, direct patient care can 
surely be aided by real-time analytics - I’ve previously shown examples where my own EPR has plotted disease outcomes over
time for a single patient compared to an aggregated dataset of similar patients to aid shared decision making and understanding.</p>

<p>Many of our issues in health and care are cultural and historically. Why do we use different programming languages
and data stores for analytics and EHRs and therefore hindering progress. We need to challenge these assumptions while embracing
standardization and mapping of data. Why are we standardising applications that are difficult to integrate, rather than
standardising our data?</p>

<p><img src="/images/mapcamp21/map-ehr.016.png" alt="Why separate direct care, analytics and research?" /></p>

<h1 id="what-do-we-need">What do we need?</h1>

<p><img src="/images/mapcamp21/map-ehr.017.png" alt="What do we need" /></p>

<p>For EHRs, you can choose a monolithic system like Epic or Cerner, which handle billing, clinical data, identity
services, and orders. Workflow support is lacking and clinical calculators are often proprietary. Data sharing is
challenging and should be standardized.</p>

<h2 id="decomposing-the-electronic-health-record">Decomposing the electronic health record</h2>

<p><img src="/images/mapcamp21/map-ehr.018.png" alt="map-ehr.018.png" /></p>

<p>Here’s what happens when we buy a monolith:</p>

<p><img src="/images/mapcamp21/map-ehr.019.png" alt="Monolith" /></p>

<p>It still will need to be integrated to a PAS, to radiology and likely a separate laboratory 
management system. It may even not be a monolith itself - for example, Cerner’s EPR is
actually a combination of a number of different products made to look like a single application.</p>

<p><img src="/images/mapcamp21/map-ehr.020.png" alt="Best of breed" /></p>

<p>Alternatively, a best-of-breed approach allows you to integrate various systems, but it’s complex and custom and 
potentially difficult to flex and adapt in the future.</p>

<p><img src="/images/mapcamp21/map-ehr.021.png" alt="User needs" /></p>

<p>Instead of focusing on the needs of an EHR, we should prioritize <em>user needs</em>, including researchers, clinicians, and
patients. Decision-making relies on evidence, communication, and action. We lack sophisticated decision support tools
and meaningful data, often siloed within organizations.</p>

<p>To improve healthcare, we need to share data securely, enhance trust, and implement open standards. Workflow management
and process orchestration are vital. Users should control their data with advanced technologies like secure enclaves and
homomorphic encryption.</p>

<p><img src="/images/mapcamp21/map-ehr.022.png" alt="Future state" /></p>

<p>Foundational services should be open and standardized, focusing on clinical data, reference data, and commodity compute
providers.</p>

<p>In the future, we should aim for user-centered applications, trust, and outcomes. Transparency, collaboration, and
openness are key principles. Open source should drive the adoption of open standards.</p>

<p><img src="/images/mapcamp21/map-ehr.023.png" alt="Future state" /></p>

<p>Modern technology companies should view the cloud as more than a data center relocation, leveraging its potential for
healthcare. This shift can disrupt the existing market, emphasizing value and patient outcomes.</p>

<p><img src="/images/mapcamp21/map-ehr.024.png" alt="Future state" /></p>

<p>Thank you.</p>]]></content><author><name></name></author><category term="strategy" /><summary type="html"><![CDATA[This is part 2/2 of my presentation at MapCamp 2021.]]></summary></entry><entry><title type="html">Mapping the electronic health record 1/2</title><link href="https://www.wardle.org/strategy/2021/10/21/mapping-the-epr-1.html" rel="alternate" type="text/html" title="Mapping the electronic health record 1/2" /><published>2021-10-21T08:00:00+01:00</published><updated>2021-10-21T08:00:00+01:00</updated><id>https://www.wardle.org/strategy/2021/10/21/mapping-the-epr-1</id><content type="html" xml:base="https://www.wardle.org/strategy/2021/10/21/mapping-the-epr-1.html"><![CDATA[<p>This blog post is based on my presentation at <a href="https://www.map-camp.com">MapCamp 2021</a>.</p>

<p><img src="/images/mapcamp21/map-ehr.001.png" alt="Title page" /></p>

<p>You can <a href="https://www.youtube.com/watch?v=9Vk6bg0uk4o">watch a video recording</a> of that presentation if you like, but this post is a 
deeper dive into some of the detail.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/9Vk6bg0uk4o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>The source code for the Wardley maps are <a href="https://github.com/wardle/mapcamp-2021">available on github</a>.</p>

<h1 id="key-messages">Key messages</h1>

<p>The main messages are:</p>

<ol>
  <li>There are many parallels between clinical decision making and strategy.</li>
  <li>We need information at the right time for our decision making, with feedback loops, whether for direct care, management of services or reproducible research.</li>
  <li>Health and care should be data-driven.</li>
  <li>Health and care should be based upon openness, transparency, collaboration and continuity, with meaningful data.</li>
  <li>Trying to fix health information technology through the prism of an organisation-centric electronic health record is difficult and we need to step back and re-appraise.</li>
  <li>Understanding the needs of the EHR (electronic health record) is useful in understanding how to deconstruct the EHR.</li>
  <li>Modern technology companies have generally failed in health and care so far. They now focus on generic data and computing services but cloud technology should be more than simply moving a data centre to someone else’s kit.</li>
  <li>We should be building the tools to build EHRs, not another EHR.</li>
  <li>The foundational software and services and tools to build EHRs should be commodities, open-source and widely available leaving the market concentrate on higher-value differentiation to support decision-making. Such services can and should be provided as shared, highly resilient, managed services.</li>
  <li>A learning health and care system must be flexible and adaptable, so the priority should be in providing configurable composable tools to manage workflow and orchestration of processes across organisational boundaries.</li>
</ol>

<h3 id="what-is-wardley-mapping">What is Wardley mapping?</h3>

<p>An excellent way to understand our current state is to start with <em>user needs</em>. We need <em>situational awareness</em>.</p>

<p>Wardley mapping draws a chain of user needs from top to bottom, demonstrating the required capabilities on a chart that moves from left-to-right in which things on the left are poorly understood and in evolution and things on the right are evolved and commodities.</p>

<p><img src="/images/mapcamp21/stages-of-evolution.png" alt="Stages of evolution" /></p>
<blockquote>
  <p>From <a href="https://blog.gardeviance.org/2016/04/whats-in-wardley-map-and-need-for-cheat.html">“What’s in a Wardley map / cheatsheet”</a>
By Simon Wardley, 2016.</p>
</blockquote>

<p>As a result, you will find potentially high-value but perhaps poorly understood, poorly systematised elements on the left of the chart.</p>

<p>Over time, these elements are likely to move rightwards and become more accepted. As such, the map helps you realise, or at least prompt debate, on where to invest your time and effort.</p>

<p>In addition, you might find elements of your organisation, or your ecosystem, seem to be in the wrong place. For example, you might be building your own data centre and your organisation is treating it as leading edge; as you draw your map you realise that is wrong.</p>

<p>Maps facilitate shared discussion.</p>

<p>All my maps are wrong but I hope they might be useful!</p>

<p>Let’s start!</p>

<h1 id="1-clinical-decision-making">1. Clinical decision making</h1>

<p>I would like to discuss diagnosis, management and decision making and the use of <em>data</em> in supporting the health of a nation.</p>

<p>There are parallels between clinical decision making and strategy.</p>

<p>Our default must be that we’re always orientated towards action - so that means <em>making decisions</em>.</p>

<p><img src="/images/mapcamp21/map-ehr.002.png" alt="Be orientated towards action" /></p>

<p>If I’m seeing you in my clinic, we need to make a diagnosis and a management plan together - we need to ask ourselves what are we going to do; it requires *information at the right time. We might take action and measure the response and change our course.</p>

<p>Most of what we have in health information technology is unintentionally designed and it’s evolved organically and it’s not fit for purpose.</p>

<p>If you’ve not used Wardley mapping before, this map may look complex. But it isn’t. We simply need to read it from top to bottom. I’ll explain this in more detail below.</p>

<p><img src="/images/mapcamp21/map-ehr.004.png" alt="Mapping clinical decision making" /></p>

<p>We start with a situation of uncertainty. We  benefit if we reduce the uncertainty around a specific decision so that we can make better decisions.</p>

<p>At the top of the map, we have a professional and a patient and we’re making a decision.</p>

<ul>
  <li>Are you going to have that knee replacement?</li>
  <li>What are the trade-offs here?</li>
  <li>What are the pros, what are the cons?</li>
  <li>Are we going to use this new treatment with this patient with COVID-19?</li>
  <li>How do we identify the patient with COVID-19 who’s going to need higher level care?</li>
</ul>

<p>Whatever the decision, it is dependent on our diagnosis of the problem. I’ve annotated ‘diagnosis’ on the map as ‘possible’, ‘probable’ or ‘definite’ so already we’re starting to think  we are creating something that is <em>iterative</em>.</p>

<p>We’re going to need feedback loops because we may need to make a speculative diagnosis and confirm and adapt as we go. We do not have a linear process but instead we use results to not only confirm but refute our thinking. Feedback loops support the ‘clinical method’ in which we combine information about diseases with information about the patient and our context.</p>

<p>We need to understand that <em>a priori</em> probabilities - we use Bayesian inference based on the prior probability of that diagnosis.</p>

<p>That means that if a patient has a fever and we are  in Africa it’s likely to be a different diagnosis than if one has a fever in the United Kingdom. Context matters.</p>

<p>We also work on pattern matching:
<img src="/images/mapcamp21/map-ehr.004-pattern.png" alt="Mapping clinical decision making" />
That’s what we teach at medical school and it’s well developed and well evolved. We teach it we expect it to be done propertly and consistently. We look at symptoms, what the patient describes; signs, the things that we can find on examination and we use investigations and all are dependent on training that occurs over many years. It should be no surprise that the patterm-matching pathway is over on the right of our map.</p>

<h3 id="learning-through-doing---feedback">Learning through doing - feedback</h3>

<p>We learn through a process of ‘doing’ which makes feedback essential. As a result, in the map you can see an iterative loop where we’re continuously learning.</p>

<p><img src="/images/mapcamp21/map-ehr.004-feedback-loops.png" alt="Feedback loops and iteration" /></p>

<p>You can imagine that type of feedback loop in three broad categories of iteration:</p>

<ol>
  <li>
    <p>You’re caring for a single patient and arrange 
tests or treatments and use the results and outcomes to modify the plan.</p>
  </li>
  <li>
    <p>You’re looking at cohorts of people - e.g. those attending a service or facility, or somebody as defined by their characteristics such as ethnicity,  age, problems, diagnoses, or the treatments that they’ve had.</p>
  </li>
  <li>
    <p>You’re trying to advance science so it’s actually clinical research in which a group of patients is compared to another after, perhaps, randomisation, or simple observation.</p>
  </li>
</ol>

<p>Frequently, these three use-cases are treated very separately, which we’ll discuss later. Ask yourself why when they are fundamentally the same, but perhaps at different levels of acuity and consent. All need to be reproducible and replicable across different cohorts.</p>

<h3 id="supporting-continuous-learning">Supporting continuous learning</h3>

<p>For continuous learning we need <em>continuity</em> and a <em>focus on outcomes</em>.</p>

<p>Paradoxically, many digital tools reduce continuity because they are used as part of reducing health and care to a system focused on transactions like a call-centre.</p>

<p>How do we assess what we’re doing unless we’re measuring outcomes in a systematic fashion?</p>

<p>If we need continuity and we want to focus on outcomes we need to routinely and systematically <em>share data</em>. Currently, it is not, except for specific examples such as registries.</p>

<p>Similarly, we’ve got to make sense of that data in context. If we’re going to measure outcomes, it’s no good just assuming that we can interpret those results - we need, as is plotted on the map, <em>meaningful data</em> and supporting <em>data standards</em> in order to aggregate, make sense and deduce.</p>

<p>For example, I’ve got work that shows how a patient with multiple sclerosis progresses over time but that only makes sense if you compare that patient to the rest of the cohort.</p>

<p>We need tools and data in order to support our decision making. That’s because we need to collect the same kind of structured data and inculcate semantic interoperability with widespread implementation of open standards.</p>

<p><img src="/images/mapcamp21/map-ehr.004-interop.png" alt="The need for interoperability" /></p>

<p>Current implementation of standards is patchy. Many implementations are proprietary, and it is usually more difficult to use a standards-based approach than something custom-built that tightly couples components with end-to-end bespoke integration.</p>

<p>In many circumstances, health and care providers need to buy a product in order to implement a standard. That’s akin to you needing to buy encryption for your web browser.</p>

<p>It therefore follows that there is an opportunity to disrupt the status quo with readily available open-source implementations of data standards and making data standards and data interoperability commodity ubiquitous across our ecosystem. This is a cultural change that is gaining momentum.</p>

<p>So the maps help us identify the areas we might wish to focus our attention.</p>

<p>I’ve spent my own time building a suite of <a href="https://github.com/wardle">open-source libraries and services</a> because that work is important and foundational.</p>

<h3 id="building-a-learning-health-system">Building a learning health system</h3>

<p><img src="/images/mapcamp21/map-ehr.005.png" alt="Where to focus" /></p>

<p>If we are to build a learning health system, we 
must therefore:</p>

<ul>
  <li>focus on meaningful outcomes</li>
  <li>consider <em>value</em></li>
  <li>share data - safely distributed at scale with consent and control</li>
  <li>consider how to make sense of data - making it <em>useful</em>.</li>
  <li>open source commodity tools and resourcec that make collecting and making sense of data straightforward - a <em>‘commons’</em> for health and care.</li>
</ul>

<p>We want the right information at the right time; accessible and useful.</p>

<p><img src="/images/mapcamp21/map-ehr.006.png" alt="Plan for learning" /></p>

<p>The next post in this series will explore what we already have in health and care and will be published soon.</p>

<p><em>Mark</em></p>]]></content><author><name></name></author><category term="strategy" /><summary type="html"><![CDATA[This blog post is based on my presentation at MapCamp 2021.]]></summary></entry><entry><title type="html">Data all the way down</title><link href="https://www.wardle.org/clinical-informatics/2021/09/08/data-all-the-way.html" rel="alternate" type="text/html" title="Data all the way down" /><published>2021-09-08T15:14:14+01:00</published><updated>2021-09-08T15:14:14+01:00</updated><id>https://www.wardle.org/clinical-informatics/2021/09/08/data-all-the-way</id><content type="html" xml:base="https://www.wardle.org/clinical-informatics/2021/09/08/data-all-the-way.html"><![CDATA[<blockquote>
  <p>“Turtles all the way down”</p>

  <p><a href="https://en.wikipedia.org/wiki/Turtles_all_the_way_down">https://en.wikipedia.org/wiki/Turtles_all_the_way_down</a></p>
</blockquote>

<p>Are you a clinician about to see a patient, reviewing the patient record in order to prepare for the consultation?</p>

<p>Or are you a manager assessing the demands on your services, and running quality improvement projects in order to improve your outcomes?</p>

<p>Or perhaps you’re a researcher looking to extend knowledge and inform the best clinical practices of tomorrow?</p>

<p>Most of us working in health and care operate in all three of these domains, but historically, each is considered separate.</p>

<p>Patient records might still be on paper, or perhaps you use an electronic patient record system.</p>

<p>Your administrative data including time from referral to different assessments and treatments are held in a patient administrative system, or more likely, across multiple administrative systems, one or more for each organisation.</p>

<p>Your research might use a bespoke registry or research system for each of your research projects.</p>

<h1 id="software-in-health-and-care">Software in health and care</h1>

<p>Software is <a href="https://wardle.org/digital/2018/10/23/on-digital.html">like magic</a> offering us the potential to automate and systematise safe and effective clinical processes and most importantly, build learning systems that can continuously monitor and improve from where we are currently.</p>

<blockquote>
  <p>As a result, digital, and being data-driven, means our planning cycles should become shorter and shorter, because we’re using small focused interventions and data to constantly evaluate our hypotheses and build a continuously learning healthcare system.</p>

  <p><a href="https://wardle.org/digital/2018/10/23/on-digital.html">Digital transformation in healthcare, 23 October 2018</a></p>
</blockquote>

<p>But we have major problem:</p>

<p><em>We separate the things that should be the same.and we join the things that should be separate.</em></p>

<p>Here’s an example from the past. The Bristol Heart scandal occurred in Bristol, UK in the 1990s, in which babies died at high rates after cardiac surgery. The report into the scandal including this in its conclusion:</p>

<blockquote>
  <p>The various clinical systems, many of them paper based, differed from one another and had no relationship with the administrative hospital-wide systems. The funding made available in the late 1980s and early 1990s for medical and later clinical audit helped to reinforce this separation by making available to groups of clinicians money for small local computer systems. The lack of any connection between these different systems, one administrative, the others clinical, for collecting data cannot be explained solely on the basis of some technical or technological reason. It was just as strongly a reflection of a mindset that clinical matters were the sole domain of clinicians and non-clinical matters, to do with the management of resources and with the movement of patients into and through the hospital, were the preserve of managers and administrators.</p>

  <p>Bristol Heart Enquiry, 2001.
(quoted in <a href="https://wardle.org/clinical-informatics/2017/06/06/using-data-patient-safety.html">“Using data for patient safety”</a>)</p>
</blockquote>

<p>But why do we separate clinical from administrative systems, and both of those from research systems?</p>

<p>There are a variety of reasons, including understanding who has responsibility for procuring, funding and designing such systems as well as issues of information governance.</p>

<p>The false separation of the needs of these three - administration, clinical practice and research, is so embedded in our culture that we even often use different tools, languages and frameworks to build the software - you might run R and python for your research, your analytics by an off-the-shelf package such as Qlik, and your electronic health record software in java or C++.</p>

<p>But are they so different really?</p>

<p>It’s straightforward to think of examples in which it is helpful to combine data relating to what is traditionally considered to be administrative with clinical data. One good example is the flow of patients through a hospital - lengths of stay are best understood in the context of medical problems and co-morbidities. Another might be making sense of clinical or diagnostic information, such as how many patients are referred with problem ‘x’. It’s all data, and it makes little sense that we use widely different software for the different purposes to which we put our data.</p>

<p>So what’s the solution?</p>

<h1 id="a-single-system">A single system?</h1>

<p>So why not have a <em>single system</em>? What a seductive yet naive idea!</p>

<p>Its naive because what do we know about building effective, adaptable, flexible computer software?</p>

<blockquote>
  <p>“Flow is difficult to achieve when each team depends on a complicated web of interactions with many other teams. For a fast flow of change to software systems, we need to remove hand-offs and align most teams to the main streams of change within the organization. However, many organizations experience huge problems with the responsibility boundaries assigned to teams. Typically, little thought is given to the viability of the boundaries for teams, resulting in a lack of ownership, disengagement, and a glacially slow rate of delivery.”
Skelton, Matthew. Team Topologies (Kindle Locations 2147-2151). IT Revolution Press. Kindle Edition.</p>
</blockquote>

<p>We <em>have</em> to break up our complex health and care domain into smaller subunits. It’s just too complicated and its safer and more effective to break up our problems into smaller tractable problems.</p>

<p>Health professionals can be seduced by the idea of buying a ‘single system’ in order to solve their problems because, quite rightly, they’ve been scarred by their experiences having to use multiple ‘systems’ in order to get the information that they need - paper records, that system, another system, another login, a different login.</p>

<p>But, but but!</p>

<blockquote>
  <p>But there is a paradox. We know that the worst ways to create a seamless “one system” approach are thinking we can build a single monolithic application or expect the procurement of a “system” to solve, for example, closer working and communication between health and social care.</p>

  <p>The best way to slow down delivery is to have an approach to technical architecture and wider governance structures that slows down the software value chain. The key to software delivery is delivery, and yet some organisations treat software as if they were managing capital projects such as building a new road or a bridge. In most cases, the technology is the easy bit; its the implementation on the ground across multiple complex adaptive systems that is most difficult. But we also need a design that makes it easy and safe to change.</p>

  <p>People who think building technology is difficult and complex tend to want to centralise and control its development, because that feels less risky, but that approach is wrong.</p>

  <p><a href="https://wardle.org/strategy/2019/09/22/health-technology.html">“Healthcare and Technology, September 2019”</a></p>
</blockquote>

<p>If we believe that software can make our work in health and care more effective, are we using the right methods in order to safely deliver that software, at pace?</p>

<p>We know existing software systems, whether for direct patient care, for analytics / governance or for research, we seem to make the same mistakes again and again:</p>

<blockquote>
  <p>Too often, software architecture and system design occurs as a consequence of organisational or management structures, rather than stepping back and truly understanding the problem domain and how to carve it up into manageable chunks. You need to understand Conway’s Law, and the reverse Conway’s manoeuvre - and place the patient foremost in the design and architecture of your systems.
<a href="https://wardle.org/ehr/2021/06/30/dependency-conway.html">The dependencies between architecture, governance and standards, June 2021</a></p>
</blockquote>

<p>The conclusion must be, therefore, that we need to <em>step back and re-appraise how we architect, fund and standardise digital health and care</em>.</p>

<p>We can get a ‘single system’ by focusing on data, standards, architecture and modularity, and enable innovation and continuous improvement - and not unduly limit our ability to adapt and change to the ever changing requirements the complex adaptive domains of health and care throw at us!</p>

<h1 id="towards-data-data-driven-health-and-composable-modularity-in-software-infrastructure">Towards data, data-driven health and composable modularity in software infrastructure.</h1>

<p>Firstly, we’ve got to recognise that fundamentally, it’s all just data.</p>

<p>We need to collect, make sense of and use data in order to do what we want to do, whether that’s running our health services, seeing an individual patient, improving our services or furthering our medical knowledge.</p>

<p>Secondly, we need structured meaningful <em>data</em> and that means data standards.</p>

<p>If we think you have had a myocardial infarction, then we need computer systems that can make the same sense of the data, and we need to think of our different sources as reference data as <em>products</em> - and use ‘product-thinking’ in how we publish, document, and make those data available - it needs to consider user experience of that data product in just as much of a way as a user-facing application.</p>

<p>Thirdly, we need to make using data, and using data standards as easy as possible.</p>

<p>No-one starts building software nowadays from nothing, but instead make use of a range of standard building blocks in order to achieve the functionality they want - whether its a cryptography library, or machine learning, or networking, these elements are commodities - usually open-source, widely available and widely-tested.</p>

<p>So if you’re starting to build clinical applications now, where are the building blocks, the commodity libraries, frameworks and services with which you can innovate?  Where is the platform on which you can build?</p>

<p>We need readily-available software modules that can make consuming and making sense of data as easy as possible. That means many software services that simply wrap reference data in order to make it usable in whatever context you need and that those services are composable with others much like an orchestra is made up of many different sections, instruments and musicians. And who can argue with Aristotle? “the whole is greater than the sum of its parts”.</p>

<h1 id="what-are-the-building-blocks">What are the building blocks?</h1>

<p>When I first built an electronic health record system, I needed the basics - understanding who the patient is, who the professional was, when someone was seen, where they were seen, what were the characteristics that help define the cohort - such as problem, diagnosis, treatment whether by surgery or drug, and geographical indicators, or derived indicators such as socio-economic deprivation.</p>

<p>I’ve realised that building such functionality into a single system is wrong.</p>

<p>As such, I’ve developed replacements as individual software components. Each is usable in isolation but I can combine them, whether as libraries in a single application or as a suite of individually running microservices, in order to solve problems. Each is designed for use in operational administrative, clinical and research systems - so are usable for direct care, service management or in my analytics. Each is open source.</p>

<ul>
  <li><a href="https://github.com/wardle/hermes">hermes</a> - a SNOMED CT terminology server and library.</li>
  <li><a href="https://github.com/wardle/dmd">dmd</a> - UK dictionary of medicines and devices server and library</li>
  <li><a href="https://github.com/wardle/clods">clods</a> - UK organisational and geographical reference data, including a FHIR r4 server</li>
  <li><a href="https://github.com/wardle/deprivare">deprivare</a> - UK deprivation indices made available in-process or via a microservice</li>
  <li><a href="https://github.com/wardle/concierge">concierge</a> - integration / interoperability with other NHS software services including patient identity / demographics / staff indexes / PAS / document repositories etc Each underlying system can be viewed through the lens of an open standard - e.g. a HL7 FHIR view.</li>
  <li><a href="https://github.com/wardle/trud">trud</a> - easy access to NHS Digital’s UK reference data services</li>
  <li><a href="https://github.com/wardle/hades">hades</a> - a FHIR R4 SNOMED terminology server</li>
  <li><a href="https://github.com/wardle/nhspd">nhspd</a> - UK postal code database with links to geographical, administrative and organisational units</li>
</ul>

<p>Let’s look at two examples in more detail:</p>

<p><a href="https:/github.com/wardle/hermes">hermes</a> makes SNOMED CT available to you easily, so you can embed as a library and run in-process or run as a terminology server. I use this to make it easy to use and make sense of SNOMED CT - both in clinical applications <em>and</em> in my analytics pipelines.</p>

<p><a href="https://github.com/wardle/clods">clods</a> allows you to download and make sense of organisational reference data. I use that with the NHS postcode directory (make available via <a href="https://github.com/wardle/nhspd">nhspd</a> to find out where a patient lives and make sense of those data - including linking to indices of deprivation. My software applications record the date, time and place of clinical encounters, and can leverage those codes - and so other systems not under my control can understand that a particular encounter occurred at, say, the University Hospital of Wales. Using these data is essential for interoperability.</p>

<p><a href="https://github.com/wardle/dmd">dmd</a> allows you to download and make sense of drug data in the UK. What kind of drugs is that patient given? How have the doses changed over time? How many milligrams of <em>that</em> ingredient is the patient taking? Is this patient on a type of immunosuppressant drug? This library and microservice takes the NHSBSA dm+d distribution and makes it usable in your applications - whether that’s for clinical care or for running your analytics.</p>

<p>For example, I switch on different functionality in my homegrown EPR based on the diagnoses of a specific patient - e.g. does this patient have a type of motor neurone disease - while doing the same in analytics - e.g. give me all of the patients who have received a type of botulinum toxin - while doing the same in clinical research - e.g. how do the outcomes of multiple sclerosis vary by socioeconomic deprivation?</p>

<h1 id="whats-needed-next">What’s needed next?</h1>

<p>We need to think carefully about how we conceive and build the clinical applications of the future. They should be data-focused, data-driven and made up of a blend of open, modular services.</p>

<p>So what are the shared services that are needed for clinical, administrative and research applications?</p>

<p>There is usually a pattern - usually interesting but often parochial data sources - we need to identify those and make them more usable - by treating them as first-class data products. That means at a minimum, good documentation, persistent non-reused identifiers and simple ways of tracking publication such as a good metadata.</p>

<p>It’s too often the case that governmental data are published on a portal for download, but do not meet these minimum requirements, making it difficult to write software that can recognise  publication of a new version and download that latest issue.</p>

<p>After the data, we need easily usable computing services that wrap that data product and make it accessible to applications, irrespective of context. That means building software that provides an API, whether in-process or as distributed microservices.</p>

<p>It is usually necessary to provide different abstractions across these services to make it easier for clients to consume health and care computing services. That usually means providing a ‘view’ of those data in an open standard.</p>

<p>For example, while <a href="https://github.com/wardle/clods">clods</a> adopts the DCB0090 standard for organisation data, that is a UK standard. Most applications will simply want to make use of organisational data at a simpler, high-level, so I make a FHIR R4 server available with a <a href="https://github.com/wardle/clods/blob/main/fhir_r4/com/eldrix/clods/fhir/r4/convert.clj">few lines of code</a> mapping DCB0090 into FHIR to make it simpler to consume.</p>

<p>So I don’t expect client software to understand the different categories of health and care organisation in DCB0090, but we can provide a ‘facade’ across those data to map into data and formats that clients can understand, such as X.500, FHIR or openEHR and provide those data on-demand. So, for example, I can view the NHS Wales’ staff directory in X.500 format (native) or as a facade using a <a href="https://www.w3.org/TR/vocab-org/">W3C organization ontological</a> view or as a <a href="https://www.hl7.org/fhir/practitioner.html">HL7 FHIR ‘view’</a>. It’s all data.</p>

<p>Data are first-class and we should treat data products as first-class as well, together with composable software tools that make using those data products in our applications, whether user-facing for direct care, analytics or research.</p>

<p><em>Mark</em></p>

<p>PS. The title of this post alludes to the phrase “Turtles all the way down”, an expression of the problem of infinite regress.</p>]]></content><author><name></name></author><category term="clinical-informatics" /><summary type="html"><![CDATA[“Turtles all the way down” https://en.wikipedia.org/wiki/Turtles_all_the_way_down]]></summary></entry><entry><title type="html">Data analytics using SNOMED CT</title><link href="https://www.wardle.org/snomed/2021/07/26/making-valuesets.html" rel="alternate" type="text/html" title="Data analytics using SNOMED CT" /><published>2021-07-26T15:14:14+01:00</published><updated>2021-07-26T15:14:14+01:00</updated><id>https://www.wardle.org/snomed/2021/07/26/making-valuesets</id><content type="html" xml:base="https://www.wardle.org/snomed/2021/07/26/making-valuesets.html"><![CDATA[<p>There’s a problem with using SNOMED CT for data analytics; in this post, I’ll explain the issue and how to mitigate! If you’re using SNOMED CT for data analytics, you <em>will</em> encounter this issue, and need to handle it!</p>

<h1 id="data-analytics-using-snomed-ct">Data analytics using SNOMED CT</h1>

<p>Imagine I’m building a real-time analytics pipeline for patients with multiple sclerosis.</p>

<p>I need to understand patient outcomes - and that means we need to define patient data into <em>cohorts</em>.</p>

<p>A cohort is a group of patients with shared characteristics.</p>

<p>That cohort might be defined by diagnosis, by treatment type, by age, by gender, by geography, by levels of socio-economic deprivation, or by something else.</p>

<p>SNOMED CT is a sophisticated and comprehensive clinical terminology that provides codes representing many of these characteristics. SNOMED is special because
it isn’t simply a flat list of codes, but instead it is an ontology. As a result SNOMED defines concepts and the relationships between them.</p>

<p>For example, it defines <em>multiple sclerosis</em> as a type of <em>demyelinating disorder</em>. This means, used properly, I can not only search health and care
data for patients with multiple sclerosis, but I can also search for demyelinating diseases and patients recorded as having multiple sclerosis will be
included in that cohort simply as a result of the SNOMED ontological hierarchies. I don’t need end-users to record a diagnosis of <em>demyelinating disorder</em>, 
but I can search for that and include all disorders that are a sub-type of that disorder.</p>

<p>I can do the same for drugs in SNOMED CT - so I might want to search for drugs that contain, say, Glatiramer acetate  - an immunological drug used in multiple sclerosis. Because the UK drug extension for SNOMED CT includes relationships such as “Has specific active ingredient”, it is straightforward to use SNOMED 
CT to slice and dice our health and care data in order to make valuable inferences.</p>

<h1 id="hermes">Hermes</h1>

<p>Hermes is an open-source terminology server that I wrote.</p>

<p>I have a tiny ($3/mo) demonstration server running - for example, you can look at detailed information about multiple sclerosis (SNOMED code 24700007) by going to <a href="http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended">http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended</a>.</p>

<p>You can have your own server running in minutes by <a href="https://github.com/wardle/hermes">following the instructions</a>, or use my demonstration links below. It can even download and install SNOMED automatically if you live in the UK.</p>

<p>Here’s an example of one of the endpoints:</p>

<p><a href="http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended">http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended</a>:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"concept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"effectiveTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2002-01-31"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"moduleId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000207008</span><span class="p">,</span><span class="w">
    </span><span class="nl">"definitionStatusId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000074008</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"descriptions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">41398015</span><span class="p">,</span><span class="w">
      </span><span class="nl">"effectiveTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-07-31"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"moduleId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000207008</span><span class="p">,</span><span class="w">
      </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="p">,</span><span class="w">
      </span><span class="nl">"languageCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"typeId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000013009</span><span class="p">,</span><span class="w">
      </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiple sclerosis"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"caseSignificanceId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000448009</span><span class="p">,</span><span class="w">
      </span><span class="nl">"refsets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">900000000000509007</span><span class="p">,</span><span class="w">
        </span><span class="mi">900000000000508004</span><span class="p">,</span><span class="w">
        </span><span class="mi">999001261000000100</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"preferredIn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">900000000000509007</span><span class="p">,</span><span class="w">
        </span><span class="mi">900000000000508004</span><span class="p">,</span><span class="w">
        </span><span class="mi">999001261000000100</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"acceptableIn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"parentRelationships"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"116680003"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">6118003</span><span class="p">,</span><span class="w">      </span><span class="mi">138875005</span><span class="p">,</span><span class="w">      </span><span class="mi">404684003</span><span class="p">,</span><span class="w">
      </span><span class="mi">123946008</span><span class="p">,</span><span class="w">      </span><span class="mi">118234003</span><span class="p">,</span><span class="w">
      </span><span class="mi">128139000</span><span class="p">,</span><span class="w">      </span><span class="mi">23853001</span><span class="p">,</span><span class="w">
      </span><span class="mi">246556002</span><span class="p">,</span><span class="w">      </span><span class="mi">363170005</span><span class="p">,</span><span class="w">
      </span><span class="mi">64572001</span><span class="p">,</span><span class="w">      </span><span class="mi">118940003</span><span class="p">,</span><span class="w">
      </span><span class="mi">414029004</span><span class="p">,</span><span class="w">      </span><span class="mi">362975008</span><span class="p">,</span><span class="w">
      </span><span class="mi">363171009</span><span class="p">,</span><span class="w">      </span><span class="mi">39367000</span><span class="p">,</span><span class="w">
      </span><span class="mi">80690008</span><span class="p">,</span><span class="w">      </span><span class="mi">362965005</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"refsets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">991381000000107</span><span class="p">,</span><span class="w">
    </span><span class="mi">999002271000000101</span><span class="p">,</span><span class="w">
    </span><span class="mi">991411000000109</span><span class="p">,</span><span class="w">
    </span><span class="mi">1127581000000103</span><span class="p">,</span><span class="w">
    </span><span class="mi">1127601000000107</span><span class="p">,</span><span class="w">
    </span><span class="mi">900000000000497000</span><span class="p">,</span><span class="w">
    </span><span class="mi">447562003</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"preferredDescription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">41398015</span><span class="p">,</span><span class="w">
    </span><span class="nl">"effectiveTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-07-31"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"moduleId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000207008</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"languageCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"typeId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000013009</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiple sclerosis"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"caseSignificanceId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000448009</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It can also provide a FHIR terminology server API via <a href="https://github.com/wardle/hades">hadex</a>.</p>

<p>Hermes operates as a library, or a microservice. It is designed to be immutable once running - so that we might have services running providing different versions of SNOMED CT, each load-balancing. Other terminology servers do not use this approach, but instead update-in-place, with management of versions within the same terminology. I prefer multiple small services and switch at the API gateway level, or reverse proxy to different versions, all of which run independently.</p>

<hr />

<h1 id="the-snomed-ct-expression-constraint-language">The SNOMED CT expression constraint language</h1>

<p>The specification for the SNOMED CT expression constraint language (ECL) is <a href="http://snomed.org/ecl">available here</a>. 
It’s a way of defining a set of SNOMED CT concepts.</p>

<p>Here’s a simple example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;  73211009 |Diabetes mellitus|     
</code></pre></div></div>

<p>This means, give me a set of codes that represent diabetes mellitus, including its sub-types. You can see the codes this expands to <a href="http://3.9.221.177:8080/v1/snomed/expand?ecl=&lt;&lt;73211009">here</a>.</p>

<p>When I am building a user interface component to allow a pop-up and autocompletion box, for say, country of birth, I might search based on 
the text the user has entered and limit the search to the set of concepts defined by:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;370159000|Country of birth|
</code></pre></div></div>

<p>This will mean a search for <a href="http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;constraint=&lt;370159000">“Cro”</a> will give me “Born in Croatia” but exclude “Crohn’s disease”.</p>

<p><a href="http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;constraint=&lt;370159000">http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;constraint=&lt;370159000</a>:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">459924011</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">315409004</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Born in Croatia"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Born in Croatia"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>I wouldn’t want to record a diagnostic term in a field that should only record concepts that are a sub-type of country of birth. I can both configure and validate user input.</p>

<p>You can think of ECL as providing a quick and easy way to define a set of codes that you’re interested in. In essence, it builds codelists - a subset of codes which can be used or searched.</p>

<p>As you might expect, you can use boolean logic in an expression to 
combine different terms. For example, if you’re searching for patients who have reduced splenic function you might use</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;234319005|Splenectomy| OR &lt;&lt;23761004|Hyposplenism|
</code></pre></div></div>

<p>You can see the results of this expression <a href="http://3.9.221.177:8080/v1/snomed/search?constraint=&lt;&lt;234319005%20OR%20&lt;&lt;23761004">here</a></p>

<p>I use the combination of a user-entered search string (e.g. “MND”) and a constraint to help users enter information in a context-appropriate way - e.g. by type, or by membership of a reference set etc.</p>

<h1 id="building-code-lists">Building code lists</h1>

<p>In summary, we can use the expressions to <em>realise</em> a codeset. For example,
we might want to build a list of diagnoses that are a type of neurological disease, suitable for use when interrogating data sources for an audit or for research.</p>

<p>In HL7 FHIR, the operation to turn an expression like this into a value set is called <em>expansion</em>.</p>

<h1 id="so-whats-the-problem">So what’s the problem?</h1>

<p>SNOMED CT is an evolving clinical terminology. That means it is updated, refined and changed over time. Fortunately, concepts are never deleted, and 
identifiers are never re-used, but concepts can be inactivated.</p>

<p>When this happens, all of its relationships are removed.</p>

<p>What this means in practice is that a now-outdated or redundant concept will not be found when we use the SNOMED CT relationships to define an interesting
set of codes!</p>

<p>Let’s look at an example related to multiple sclerosis.</p>

<p>So we want all patients who have multiple sclerosis?</p>

<p>Won’t the codes we need will be included in the result of:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt; 24700007
</code></pre></div></div>

<p>That means give me the concept 24700007 and all of its descendants (sub-types). Have a look at the results <a href="http://3.9.221.177:8080/v1/snomed/expand?ecl=&lt;&lt;24700007">here</a>.</p>

<p>No it won’t!</p>

<p>Have a look at <a href="https://termbrowser.nhs.uk/?perspective=full&amp;conceptId1=24700007">24700007 in the SNOMED online browser</a>  - and start clicking on the children and
the children of those children. The expression ‘«24700007’ will, in essence, return all of them for you in an instant.</p>

<h2 id="legacy-data">Legacy data!</h2>

<p>But let’s look at our legacy data. In our electronic health and care record, we have some old data that includes the concept <a href="https://termbrowser.nhs.uk/?perspective=full&amp;conceptId1=155023009">155023009</a> - this is an outdated, inactive concept representing multiple sclerosis, and it won’t be found using <code class="language-plaintext highlighter-rouge">&lt;&lt;24700007</code>! It won’t be found because inactivated concepts don’t have any active relationships.</p>

<p>This a problem!</p>

<p>That patient, just because they’ve been recorded as having multiple sclerosis using a term now inactive, potentially won’t show up in our dataset! This isn’t an uncommon scenario; and it is a problem that will increase as more health and care software uses SNOMED CT.</p>

<h1 id="what-are-the-potential-solutions">What are the potential solutions?</h1>

<p>There are four options:</p>

<ol>
  <li>Highlight now inactive concepts in our dataset and manually update to the modern equivalents ie. fix our source data manually by flagging to end clinical users. Fix the problem by fixing our source data.</li>
  <li>When processing our dataset, highlight inactive concepts and append the modern replacements or equivalents.</li>
  <li>When generating searches, include outdated concepts in the code lists.</li>
  <li>Provide easy access to multiple versions of SNOMED CT, selectable at runtime, so that inferences can be made based on the date the data were entered at each point.</li>
</ol>

<p>There are a variety of trade-offs for each option but each can make use of the historical
association reference sets that are provided as part of SNOMED CT.</p>

<p>An historical reference set provides a linkage between a now-outdated concept and what it might be better represented as nowadays.</p>

<p>Unfortunately, this isn’t as simple as it might sound. Some concepts are genuinely now regarded as wrong - or may be better represented using one of many more specific terms. Imagine a disease we used to think of as a single entity, but now realise that diagnostic entity is better represented
as one of three different more specific entities, that might or might not
be exactly equivalent?</p>

<p>Here are some example reference sets that will help us:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Name                     Concept identifier

REPLACED-BY              900000000000526001
SAME-AS                  900000000000527005
POSSIBLY-EQUIVALENT-TO   900000000000523009
</code></pre></div></div>

<p>The simplest is REPLACED-BY. There’ll be a 1:1 mapping between an old concept and a new concept if there is one that is conceptually REPLACED-BY the new one! But some concepts are truly outdated, and there will be some ambiguity in how to use that now outdated term.</p>

<p>We can even ask SNOMED to give us all of the historical association reference set types: <a href="http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C900000000000522004">http://3.9.221.177:8080/v1/snomed/expand?ecl=&lt;900000000000522004</a></p>

<p>Result:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000001151017</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000523009</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POSSIBLY EQUIVALENT TO association reference set"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POSSIBLY EQUIVALENT TO association reference set"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000001152012</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000524003</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOVED TO association reference set"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOVED TO association reference set"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000001154013</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000525002</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOVED FROM association reference set"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOVED FROM association reference set"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000001157018</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000526001</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REPLACED BY association reference set"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REPLACED BY association reference set"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>When operating interactively, we can ask our user to resolve ambiguities and map to a more modern term.
But what about for analytics? We might be processing millions of health records in which it will not be practical to update legacy terms by hand.</p>

<p>We are left with two options:</p>

<ol>
  <li>
    <p>Pre-process each health and care record mapping legacy terms to modern equivalents.</p>
  </li>
  <li>
    <p>Pre-process our searches, valuesets and code lists so that they include legacy inactive concepts as well as the modern equivalents.</p>
  </li>
</ol>

<h3 id="pre-process-the-health-and-care-record">Pre-process the health and care record</h3>

<p>For our inactive term, in our data pipeline, we could look for
this concept’s historical association reference sets and include some or all of the modern replacements in-place.</p>

<p>We then perform analysis on a modified patient record that has been updated to use only active terms.</p>

<p>We can do this easily by identifying now inactivated concepts, and following the historical associations for that concept.</p>

<p>Let’s try a worked example:</p>

<p>You can see that <a href="https://termbrowser.nhs.uk/?perspective=full&amp;conceptId1=155023009">155023009</a> is inactive - and you can see the same via <a href="http://3.9.221.177:8080/v1/snomed/concepts/155023009">hermes</a>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">155023009</span><span class="p">,</span><span class="w">
  </span><span class="nl">"effectiveTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2002-01-31"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"moduleId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000207008</span><span class="p">,</span><span class="w">
  </span><span class="nl">"definitionStatusId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000074008</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We can use this concept’s reference set membership to see how SNOMED thinks we might be able to map into the current version of the terminology:</p>

<p><a href="http://3.9.221.177:8080/v1/snomed/concepts/155023009/historical">http://3.9.221.177:8080/v1/snomed/concepts/155023009/historical</a>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"900000000000527005"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc542ff9-d695-52ff-a20b-8091e5b0145b"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"effectiveTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2002-01-31"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"moduleId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000207008</span><span class="p">,</span><span class="w">
      </span><span class="nl">"refsetId"</span><span class="p">:</span><span class="w"> </span><span class="mi">900000000000527005</span><span class="p">,</span><span class="w">
      </span><span class="nl">"referencedComponentId"</span><span class="p">:</span><span class="w"> </span><span class="mi">155023009</span><span class="p">,</span><span class="w">
      </span><span class="nl">"targetComponentId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This end-point picks out only the historical association reference set types and lists them conveniently keyed by the association reference type. This makes it straightforward to follow SAME-AS, REPLACED-BY or POSSIBLY-EQUIVALENT-TO links.</p>

<p>So here we see that <code class="language-plaintext highlighter-rouge">155023009</code> is linked to <code class="language-plaintext highlighter-rouge">24700007</code> by virtue of a <code class="language-plaintext highlighter-rouge">SAME-AS</code> definition - <a href="http://3.9.221.177:8080/v1/snomed/concepts/900000000000527005/extended">900000000000527005</a>.</p>

<h3 id="pre-process-our-searches-valuesets-and-codelists">Pre-process our searches, valuesets and codelists</h3>

<p>Alternatively, when we’re generating a list of codes for our code list, we could reverse this process and look at the modern concept(s) in which we are interested and get back the legacy inactive identifiers that we want to include.</p>

<p>We can ask hermes to expand any arbitrary SNOMED expression constraint language (ECL) expression:</p>

<p>e.g.</p>

<p><a href="http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007">http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007</a>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1223980016</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MS - Multiple sclerosis"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiple sclerosis"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>But we can also ask for the expansion to include historical associations:</p>

<p><a href="http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&amp;include-historic=true">http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&amp;include-historic=true</a></p>

<p>You’ll see that our expanded codelist now also includes outdated, inactivated concepts from past versions of SNOMED. We can now use this expanded list for our data analytics.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">27239011</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">16092000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cord multiple sclerosis"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cord multiple sclerosis"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">30986014</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">18353007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brain stem multiple sclerosis"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brain stem multiple sclerosis"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1223980016</span><span class="p">,</span><span class="w">
    </span><span class="nl">"conceptId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24700007</span><span class="p">,</span><span class="w">
    </span><span class="nl">"term"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MS - Multiple sclerosis"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferredTerm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiple sclerosis"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<h1 id="conclusions">Conclusions</h1>

<p>Managing real-life health and care data is complex; health informatics needs to build software, ideally open-source, that manages some of these complexities. Open-source tools are ideal, because we create a shared community.</p>

<p><a href="https://github.com/wardle/hermes">Hermes</a> is a library and microservice that provides some of that capability in relation to SNOMED CT and other terminologies.</p>

<p>You cannot ignore the issue of managing codes now thought of as inactive, or outdated from your health and care data, but instead you need to think carefully about how to manage change over time.</p>

<p>Hermes provides a number of ways of managing those changes including versioned distributions, methods to identify and understand how to map outdated concepts to modern equivalents, to methods to create codelists based on expressions that optionally include historical equivalents of their members.</p>

<p><em>Mark</em></p>]]></content><author><name></name></author><category term="snomed" /><summary type="html"><![CDATA[There’s a problem with using SNOMED CT for data analytics; in this post, I’ll explain the issue and how to mitigate! If you’re using SNOMED CT for data analytics, you will encounter this issue, and need to handle it!]]></summary></entry><entry><title type="html">A mistake at REST</title><link href="https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest.html" rel="alternate" type="text/html" title="A mistake at REST" /><published>2021-06-30T16:07:08+01:00</published><updated>2021-06-30T16:07:08+01:00</updated><id>https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest</id><content type="html" xml:base="https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest.html"><![CDATA[<p>The HL7 FHIR standard provides a useful model of health and care information, but it is a specification from which a local standard can be built via <em>profiling</em>. It defines models of data and a specification for how to exchange those data via an architectural pattern called representational state transfer (REST). While there are other ways that data in HL7 FHIR can be exchanged, using REST as an architectural pattern means that software using HL7 FHIR for data exchange will read and write to <em>resources</em> that represent something in the health and care domain.</p>

<p>You can read about the RESTful aspects of HL7 FHIR in more detail on the <a href="https://www.hl7.org/fhir/http.html">official HL7 FHIR website</a>.</p>

<p>The semantics of that architectural pattern are of reading, or writing, deleting or searching, or doing something else to a resource.</p>

<p>The problem is that health care doesn’t use that semantic pattern.</p>

<h1 id="read-and-write-semantics">Read and write semantics</h1>

<p>Medical records are immutable. As I <a href="/images/cis_design/cis_design.pdf">wrote in 2017</a>:</p>

<blockquote>

  <p>Immutability refers to an approach to software engineering in which data are unchangeable. 
Such an approach is particularly suitable when considering medical
records and processes. Indeed, from a medico-legal perspective, all data should
be regarded as immutable as it is usually necessary to be able to view the state of
the record at any point in time.</p>

  <p><a href="/images/cis_design/cis_design.pdf">Section 5.11, Clinical information system design : Mark Wardle, 2017</a></p>
</blockquote>

<p>Our paper records accumulate. They accrete.</p>

<p>We don’t rip out old information.</p>

<p>New records update and take the place of older records in our <em>decision-making</em>, but those
older records still exist.</p>

<p>Of course, most implementations will not actually delete data when when we issue a DELETE against a resource. 
For example, if we issue a DELETE against a resource representing an organisation in our health and care environment, 
the underlying software is likely to effect that change by simply marking that organisation as deleted.</p>

<p>So what’s the issue?</p>

<p>It’s that thinking that the <em>model</em> of data that we use to examine, process and make sense of a health and care record 
is the same as the one that might populate that medical record in the first place.</p>

<h1 id="different-models-for-reading-and-writing">Different models for reading and writing</h1>

<p>The problem is that the modelling of information used for reading is widely different to that information we record
as a consequence of the processes of care.</p>

<p>The medical record is not simply a record, but a working <em>tool</em> that helps professionals and patients make sense and
reduce the uncertainty about a decision, whether that decision is about an individual patient (shall I have that procedure?),
a clinical service (how do we configure our service to best improve outcomes?) or for research (what new knowledge can we gain?).</p>

<blockquote>
  <p>“You’re a victim of it or a triumph because of it. The human mind
simply cannot carry all the information without error so the record
becomes part of your practice.”
<a href="https://www.youtube.com/watch?v=qMsPXSMTpFI">Dr Larry Weed, Internal Medicine Grand Rounds, 1971</a></p>
</blockquote>

<p>In other complex domains, a pattern of command query responsibility separation (CQRS) has been used in which
the information models of querying (reading) data are separate from those of creating data.</p>

<p>I would argue that for many situations in health and care, we should build quite different data models for issuing “commands” 
or “actions” than the data models I subsequently use in order to make sense of the record.</p>

<p>We should move away from REST semantics towards separating how we think about commands from how we think about queries.</p>

<p>For example, I <em>prescribe</em> a drug (an action) and that data model, that domain event, is used to populate a view (a query) of all recently prescribed drugs and provide a flattened ‘view’ of a medication list based on those actions. I am not reading and writing a medication list, but the list is built as a consequence of the actions.</p>

<p>This approach scales well to the medical record, because the medical record should be dominated by <em>reads</em>. That means it is very easy to optimise reading and processing of data differently to the systems that handle writing.</p>

<p>It also simplifies our data modelling work - because we can build clinical data models that focus on workflow and process (our actions), and then separately conceive of the best ways to make sense and view the logical record - quite rightly through different ‘prisms’ depending on need.</p>

<p><em>Mark</em></p>

<hr />]]></content><author><name></name></author><category term="ehr" /><summary type="html"><![CDATA[The HL7 FHIR standard provides a useful model of health and care information, but it is a specification from which a local standard can be built via profiling. It defines models of data and a specification for how to exchange those data via an architectural pattern called representational state transfer (REST). While there are other ways that data in HL7 FHIR can be exchanged, using REST as an architectural pattern means that software using HL7 FHIR for data exchange will read and write to resources that represent something in the health and care domain.]]></summary></entry><entry><title type="html">The dependencies between architecture, governance and standards.</title><link href="https://www.wardle.org/ehr/2021/06/30/dependency-conway.html" rel="alternate" type="text/html" title="The dependencies between architecture, governance and standards." /><published>2021-06-30T07:07:08+01:00</published><updated>2021-06-30T07:07:08+01:00</updated><id>https://www.wardle.org/ehr/2021/06/30/dependency-conway</id><content type="html" xml:base="https://www.wardle.org/ehr/2021/06/30/dependency-conway.html"><![CDATA[<p>I <a href="/ehr/2019/11/08/learning-from-creating-an-ehr.html">built an electronic health record and along the way learnt a lot</a> about how to think about the importance of medical records and <em>data</em> in my day-to-day work as a practising clinician, manager and researcher.</p>

<p>At the end of that talk (and post), I touched on the importance of building <em>capability</em> : in data and the software that use those data - to deliver the outcomes we want in health and care. But what does that mean? What are the capabilities that we need to build, specifically?</p>

<p>I would argue:</p>

<ul>
  <li>our capabilities to record, view, manipulate and infer from <em>meaningful data</em> - for direct care, for managing our services and for research.</li>
</ul>

<p>depend upon</p>

<ul>
  <li>our capabilities to continually deliver safe, sustainable and secure software at pace.</li>
</ul>

<p>and we can look to the characteristics of the highest-performing technology teams to understand that these depend upon:</p>

<ul>
  <li>small, empowered, cross-functional (multi-disciplinary) teams</li>
  <li>appropriate modularisation, with well-defined contractual (standards-based) interfaces between those modules</li>
  <li>fast feedback via automated testing and telemetry, monitoring and logging</li>
  <li>fast feedback from users with iterative, agile working</li>
</ul>

<p>and understand, therefore, there is:</p>

<ul>
  <li>mutual dependency between architecture, governance and standards</li>
</ul>

<p>because our capabilities are determined by our teams and how they can work effectively, and that means building an architecture that breaks down our problems into solvable chunks, making sure that governance is streamlined and effective so that there are clear lines of responsibility and defining the interactions between teams and the products for which they are responsible via open published standards as one part of the contractual obligations between those teams and products.</p>

<h1 id="building-products-delivering-outcomes--choose-team-first-boundaries">Building products delivering outcomes : “Choose team-first boundaries”</h1>

<p>Truly, our architecture and governance are mutually-dependent with <em>technical standards</em> as an integral part of the wider contracts between our modules and consequently, between our teams.</p>

<p>It makes little sense to govern programmes of work without respecting architectural boundaries; indeed, I would argue that many of the issues facing health and care services in Wales are as a result of ignoring this issue - such as thinking that it is appropriate to govern projects relating to patients and their interactions with services separately to projects relating to professionals, when in fact both <em>programmes</em> of work share many core building blocks, such as citizen identity.</p>

<p>So instead need to recognise the importance of constructing <em>empowered teams</em> to help us solve the problems we face and organise those teams into specific programmes of work.</p>

<p>The mantra must surely be:</p>

<blockquote>
  <p>long-lived products within dynamic flexible programmes,</p>
</blockquote>

<blockquote>
  <p>“Flow is difficult to achieve when each team depends on a complicated web of interactions with many other teams. For a fast flow of change to software systems, we need to remove hand-offs and align most teams to the main streams of change within the organization. However, many organizations experience huge problems with the responsibility boundaries assigned to teams. Typically, little thought is given to the viability of the boundaries for teams, resulting in a lack of ownership, disengagement, and a glacially slow rate of delivery.”</p>

  <p>Skelton, Matthew. Team Topologies (Kindle Locations 2147-2151). IT Revolution Press. Kindle Edition.</p>
</blockquote>

<p>So how do we find the <em>fracture planes</em> within our truly complex and heterogeneous systems?</p>

<blockquote>
  <p>“A fracture plane is a natural seam in the software system that allows the system to be split easily into two or more parts. This splitting of software is particularly useful with monolithic software. The word monolith itself comes from Greek, meaning “single stone.” Traditional stonemasons hit stones at particular angles to split the rocks in clean segments, taking advantage of their natural fracture planes. We can look for similar fracture planes in software to find the natural split points that lead to software boundaries.”</p>

  <p>Skelton, Matthew. Team Topologies (Kindle Locations 2226-2227). IT Revolution Press. Kindle Edition.</p>
</blockquote>

<p>Too often, software architecture and system design occurs as a consequence of organisational or management structures, rather than stepping back and truly understanding the problem domain and how to carve it up into manageable chunks. You need to understand Conway’s Law, and the reverse Conway’s manoevre - and place the patient foremost in the design and architecture of your systems.</p>

<p>Mark</p>

<hr />
<blockquote>

  <p>This post was originally written in November 2019.</p>
</blockquote>]]></content><author><name></name></author><category term="ehr" /><summary type="html"><![CDATA[I built an electronic health record and along the way learnt a lot about how to think about the importance of medical records and data in my day-to-day work as a practising clinician, manager and researcher.]]></summary></entry><entry><title type="html">Decomposing the electronic health and care record</title><link href="https://www.wardle.org/patientcare/2021/03/28/next-steps-epr.html" rel="alternate" type="text/html" title="Decomposing the electronic health and care record" /><published>2021-03-28T10:09:09+01:00</published><updated>2021-03-28T10:09:09+01:00</updated><id>https://www.wardle.org/patientcare/2021/03/28/next-steps-epr</id><content type="html" xml:base="https://www.wardle.org/patientcare/2021/03/28/next-steps-epr.html"><![CDATA[<p>So I built an electronic patient record system that’s been running since 2007. It was, as far as I am aware, the first implementation of SNOMED CT in a live clinical system. Most users have never known that SNOMED is its <em>lingua franca</em>, and most think it is a bespoke ‘database’ for their use, because
I built multiple subject and specialty-specific “prisms” through which to see, what is essentially,
a single record.</p>

<p>There is no better iterative fast feedback loop than being a user as well as a developer. It is difficult to know what works and what doesn’t work without an exploratory phase of design and implementation.</p>

<p>That software now supports the care of thousands of patients across Wales, over 126000 lines of code and on today’s estimates would cost $6 million to develop.</p>

<p>But as with any large software application, it’s starting to become more difficult to make changes. Early design decisions accelerated progress but are unduly limiting now. Early assumptions about how and where the application might be used are now proven wrong.</p>

<p>Such issues are common in all software projects.</p>

<p>In NHS Wales, we have made amazing progress on some core national services solving difficult problems; we now have services for shared clinical documents, investigation results such as laboratory and radiology as well as a national staff directory and an enterprise master patient index providing a single cross-organisation view of patient identity.</p>

<p>But the clinical application that staff use to access data in those services - Welsh Clinical Portal - will never be an electronic patient record. Early design decisions have bound it tightly to the local patient administrative system in each organisation and tight-coupling means that changes are difficult to make, and some health boards have requests for change that have waited years to be implemented.</p>

<p>It is time we modernised the way we think about and develop health and care technology.</p>

<p>One of the most effective ways of doing that is to recognise the benefits of modularisation, in which we break apart the problems we face to make them easier to solve and recompose those modules in interesting ways in order to solve problems for professionals and patients.</p>

<p>Understanding how and when to modularise requires significant technical and domain knowledge taking into account existing legacy services and the commercial market. We can use open technical standards to decouple those components. This is one way that we can pay down some of the technical debt built up over years.</p>

<p>The NHS Wales Informatics Service is being transformed into a new statutory body on 1st April 2021.</p>

<p>Now is the ideal opportunity for it to become the digital platform on which we build a seamless, effective and safe health and care service for Wales.</p>

<p>It can and should be a provider of national shared services - much like Amazon has “Amazon Web Services” - with small, long-lived teams of experts providing a range of data and software services as well as support for provider organisations to make use of those services to improve their services.</p>

<p>Its mission cannot simply be “driving change” in the health service - there’s plenty of evidence that health boards are desperate to improve services using digital technology - it must be focusing on the work that can and should be shared across health and care in Wales - and working to <em>enable</em> change by the provision of a suite of <em>open</em> data and computing services.</p>

<p><em>Mark</em></p>]]></content><author><name></name></author><category term="patientcare" /><summary type="html"><![CDATA[So I built an electronic patient record system that’s been running since 2007. It was, as far as I am aware, the first implementation of SNOMED CT in a live clinical system. Most users have never known that SNOMED is its lingua franca, and most think it is a bespoke ‘database’ for their use, because I built multiple subject and specialty-specific “prisms” through which to see, what is essentially, a single record.]]></summary></entry></feed>