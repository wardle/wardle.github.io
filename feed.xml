<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.4.1">Jekyll</generator><link href="https://www.wardle.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.wardle.org/" rel="alternate" type="text/html" /><updated>2021-07-27T12:48:33+01:00</updated><id>https://www.wardle.org/feed.xml</id><title type="html">Health informatics and information technology</title><subtitle>by Dr Mark Wardle, Consultant Neurologist, clinical informatics and software developer. Founder, Eldrix Ltd.
</subtitle><entry><title type="html">Data analytics using SNOMED CT</title><link href="https://www.wardle.org/snomed/2021/07/26/making-valuesets.html" rel="alternate" type="text/html" title="Data analytics using SNOMED CT" /><published>2021-07-26T15:14:14+01:00</published><updated>2021-07-26T15:14:14+01:00</updated><id>https://www.wardle.org/snomed/2021/07/26/making-valuesets</id><content type="html" xml:base="https://www.wardle.org/snomed/2021/07/26/making-valuesets.html">&lt;p&gt;There’s a problem with using SNOMED CT for data analytics; in this post, I’ll explain the issue and how to mitigate! If you’re using SNOMED CT for data analytics, you &lt;em&gt;will&lt;/em&gt; encounter this issue, and need to handle it!&lt;/p&gt;

&lt;h1 id=&quot;data-analytics-using-snomed-ct&quot;&gt;Data analytics using SNOMED CT&lt;/h1&gt;

&lt;p&gt;Imagine I’m building a real-time analytics pipeline for patients with multiple sclerosis.&lt;/p&gt;

&lt;p&gt;I need to understand patient outcomes - and that means we need to define patient data into &lt;em&gt;cohorts&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;A cohort is a group of patients with shared characteristics.&lt;/p&gt;

&lt;p&gt;That cohort might be defined by diagnosis, by treatment type, by age, by gender, by geography, by levels of socio-economic deprivation, or by something else.&lt;/p&gt;

&lt;p&gt;SNOMED CT is a sophisticated and comprehensive clinical terminology that provides codes representing many of these characteristics. SNOMED is special because
it isn’t simply a flat list of codes, but instead it is an ontology. As a result SNOMED defines concepts and the relationships between them.&lt;/p&gt;

&lt;p&gt;For example, it defines &lt;em&gt;multiple sclerosis&lt;/em&gt; as a type of &lt;em&gt;demyelinating disorder&lt;/em&gt;. This means, used properly, I can not only search health and care
data for patients with multiple sclerosis, but I can also search for demyelinating diseases and patients recorded as having multiple sclerosis will be
included in that cohort simply as a result of the SNOMED ontological hierarchies. I don’t need end-users to record a diagnosis of &lt;em&gt;demyelinating disorder&lt;/em&gt;, 
but I can search for that and include all disorders that are a sub-type of that disorder.&lt;/p&gt;

&lt;p&gt;I can do the same for drugs in SNOMED CT - so I might want to search for drugs that contain, say, Glatiramer acetate  - an immunological drug used in multiple sclerosis. Because the UK drug extension for SNOMED CT includes relationships such as “Has specific active ingredient”, it is straightforward to use SNOMED 
CT to slice and dice our health and care data in order to make valuable inferences.&lt;/p&gt;

&lt;h1 id=&quot;hermes&quot;&gt;Hermes&lt;/h1&gt;

&lt;p&gt;Hermes is an open-source terminology server that I wrote.&lt;/p&gt;

&lt;p&gt;I have a tiny ($3/mo) demonstration server running - for example, you can look at detailed information about multiple sclerosis (SNOMED code 24700007) by going to &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended&quot;&gt;http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can have your own server running in minutes by &lt;a href=&quot;https://github.com/wardle/hermes&quot;&gt;following the instructions&lt;/a&gt;, or use my demonstration links below. It can even download and install SNOMED automatically if you live in the UK.&lt;/p&gt;

&lt;p&gt;Here’s an example of one of the endpoints:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended&quot;&gt;http://3.9.221.177:8080/v1/snomed/concepts/24700007/extended&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;concept&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effectiveTime&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2002-01-31&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;active&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moduleId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000207008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;definitionStatusId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000074008&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;descriptions&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;41398015&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effectiveTime&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-07-31&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;active&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moduleId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000207008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;languageCode&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;typeId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000013009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;caseSignificanceId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000448009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;refsets&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000509007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000508004&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;999001261000000100&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredIn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000509007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000508004&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;999001261000000100&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;acceptableIn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;parentRelationships&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;116680003&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6118003&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;138875005&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404684003&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;123946008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;118234003&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;128139000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;23853001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;246556002&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;363170005&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64572001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;118940003&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;414029004&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;362975008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;363171009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;39367000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;80690008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;362965005&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;refsets&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;991381000000107&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;999002271000000101&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;991411000000109&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1127581000000103&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1127601000000107&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000497000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;447562003&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredDescription&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;41398015&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effectiveTime&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-07-31&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;active&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moduleId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000207008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;languageCode&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;typeId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000013009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;caseSignificanceId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000448009&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It can also provide a FHIR terminology server API via &lt;a href=&quot;https://github.com/wardle/hades&quot;&gt;hadex&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Hermes operates as a library, or a microservice. It is designed to be immutable once running - so that we might have services running providing different versions of SNOMED CT, each load-balancing. Other terminology servers do not use this approach, but instead update-in-place, with management of versions within the same terminology. I prefer multiple small services and switch at the API gateway level, or reverse proxy to different versions, all of which run independently.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;the-snomed-ct-expression-constraint-language&quot;&gt;The SNOMED CT expression constraint language&lt;/h1&gt;

&lt;p&gt;The specification for the SNOMED CT expression constraint language (ECL) is &lt;a href=&quot;http://snomed.org/ecl&quot;&gt;available here&lt;/a&gt;. 
It’s a way of defining a set of SNOMED CT concepts.&lt;/p&gt;

&lt;p&gt;Here’s a simple example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;&amp;lt;  73211009 |Diabetes mellitus|     
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means, give me a set of codes that represent diabetes mellitus, including its sub-types. You can see the codes this expands to &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/expand?ecl=&amp;lt;&amp;lt;73211009&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When I am building a user interface component to allow a pop-up and autocompletion box, for say, country of birth, I might search based on 
the text the user has entered and limit the search to the set of concepts defined by:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;370159000|Country of birth|
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will mean a search for &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;amp;constraint=&amp;lt;370159000&quot;&gt;“Cro”&lt;/a&gt; will give me “Born in Croatia” but exclude “Crohn’s disease”.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;amp;constraint=&amp;lt;370159000&quot;&gt;http://3.9.221.177:8080/v1/snomed/search?s=cro&amp;amp;constraint=&amp;lt;370159000&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;459924011&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;315409004&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Born in Croatia&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredTerm&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Born in Croatia&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wouldn’t want to record a diagnostic term in a field that should only record concepts that are a sub-type of country of birth. I can both configure and validate user input.&lt;/p&gt;

&lt;p&gt;You can think of ECL as providing a quick and easy way to define a set of codes that you’re interested in. In essence, it builds codelists - a subset of codes which can be used or searched.&lt;/p&gt;

&lt;p&gt;As you might expect, you can use boolean logic in an expression to 
combine different terms. For example, if you’re searching for patients who have reduced splenic function you might use&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;&amp;lt;234319005|Splenectomy| OR &amp;lt;&amp;lt;23761004|Hyposplenism|
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see the results of this expression &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/search?constraint=&amp;lt;&amp;lt;234319005%20OR%20&amp;lt;&amp;lt;23761004&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I use the combination of a user-entered search string (e.g. “MND”) and a constraint to help users enter information in a context-appropriate way - e.g. by type, or by membership of a reference set etc.&lt;/p&gt;

&lt;h1 id=&quot;building-code-lists&quot;&gt;Building code lists&lt;/h1&gt;

&lt;p&gt;In summary, we can use the expressions to &lt;em&gt;realise&lt;/em&gt; a codeset. For example,
we might want to build a list of diagnoses that are a type of neurological disease, suitable for use when interrogating data sources for an audit or for research.&lt;/p&gt;

&lt;p&gt;In HL7 FHIR, the operation to turn an expression like this into a value set is called &lt;em&gt;expansion&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&quot;so-whats-the-problem&quot;&gt;So what’s the problem?&lt;/h1&gt;

&lt;p&gt;SNOMED CT is an evolving clinical terminology. That means it is updated, refined and changed over time. Fortunately, concepts are never deleted, and 
identifiers are never re-used, but concepts can be inactivated.&lt;/p&gt;

&lt;p&gt;When this happens, all of its relationships are removed.&lt;/p&gt;

&lt;p&gt;What this means in practice is that a now-outdated or redundant concept will not be found when we use the SNOMED CT relationships to define an interesting
set of codes!&lt;/p&gt;

&lt;p&gt;Let’s look at an example related to multiple sclerosis.&lt;/p&gt;

&lt;p&gt;So we want all patients who have multiple sclerosis?&lt;/p&gt;

&lt;p&gt;Won’t the codes we need will be included in the result of:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;&amp;lt; 24700007
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That means give me the concept 24700007 and all of its descendants (sub-types). Have a look at the results &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/expand?ecl=&amp;lt;&amp;lt;24700007&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;No it won’t!&lt;/p&gt;

&lt;p&gt;Have a look at &lt;a href=&quot;https://termbrowser.nhs.uk/?perspective=full&amp;amp;conceptId1=24700007&quot;&gt;24700007 in the SNOMED online browser&lt;/a&gt;  - and start clicking on the children and
the children of those children. The expression ‘«24700007’ will, in essence, return all of them for you in an instant.&lt;/p&gt;

&lt;h2 id=&quot;legacy-data&quot;&gt;Legacy data!&lt;/h2&gt;

&lt;p&gt;But let’s look at our legacy data. In our electronic health and care record, we have some old data that includes the concept &lt;a href=&quot;https://termbrowser.nhs.uk/?perspective=full&amp;amp;conceptId1=155023009&quot;&gt;155023009&lt;/a&gt; - this is an outdated, inactive concept representing multiple sclerosis, and it won’t be found using &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;&amp;lt;24700007&lt;/code&gt;! It won’t be found because inactivated concepts don’t have any active relationships.&lt;/p&gt;

&lt;p&gt;This a problem!&lt;/p&gt;

&lt;p&gt;That patient, just because they’ve been recorded as having multiple sclerosis using a term now inactive, potentially won’t show up in our dataset! This isn’t an uncommon scenario; and it is a problem that will increase as more health and care software uses SNOMED CT.&lt;/p&gt;

&lt;h1 id=&quot;what-are-the-potential-solutions&quot;&gt;What are the potential solutions?&lt;/h1&gt;

&lt;p&gt;There are four options:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Highlight now inactive concepts in our dataset and manually update to the modern equivalents ie. fix our source data manually by flagging to end clinical users. Fix the problem by fixing our source data.&lt;/li&gt;
  &lt;li&gt;When processing our dataset, highlight inactive concepts and append the modern replacements or equivalents.&lt;/li&gt;
  &lt;li&gt;When generating searches, include outdated concepts in the code lists.&lt;/li&gt;
  &lt;li&gt;Provide easy access to multiple versions of SNOMED CT, selectable at runtime, so that inferences can be made based on the date the data were entered at each point.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;There are a variety of trade-offs for each option but each can make use of the historical
association reference sets that are provided as part of SNOMED CT.&lt;/p&gt;

&lt;p&gt;An historical reference set provides a linkage between a now-outdated concept and what it might be better represented as nowadays.&lt;/p&gt;

&lt;p&gt;Unfortunately, this isn’t as simple as it might sound. Some concepts are genuinely now regarded as wrong - or may be better represented using one of many more specific terms. Imagine a disease we used to think of as a single entity, but now realise that diagnostic entity is better represented
as one of three different more specific entities, that might or might not
be exactly equivalent?&lt;/p&gt;

&lt;p&gt;Here are some example reference sets that will help us:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SAME-AS
REPLACED-BY
POSSIBLY-EQUIVALENT-TO
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The simplest is SAME-AS. There’ll be a 1:1 mapping between an old concept and a new concept if there is one that is conceptually the SAME-AS the old! But some concepts are truly outdated, and there will be some ambiguity in how to use that now outdated term.&lt;/p&gt;

&lt;p&gt;When operating interactively, we can ask our user to resolve ambiguities and map to a more modern term.
But what about for analytics? We might be processing millions of health records in which it will not be practical to update legacy terms by hand.&lt;/p&gt;

&lt;p&gt;We are left with two options:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Pre-process each health and care record mapping legacy terms to modern equivalents.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Pre-process our searches, valuesets and code lists so that they include legacy inactive concepts as well as the modern equivalents.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;pre-process-the-health-and-care-record&quot;&gt;Pre-process the health and care record&lt;/h3&gt;

&lt;p&gt;For our inactive term, in our data pipeline, we could look for
this concept’s historical association reference sets and include some or all of the modern replacements in-place.&lt;/p&gt;

&lt;p&gt;We then perform analysis on a modified patient record that has been updated to use only active terms.&lt;/p&gt;

&lt;p&gt;We can do this easily by identifying now inactivated concepts, and following the historical associations for that concept.&lt;/p&gt;

&lt;p&gt;Let’s try a worked example:&lt;/p&gt;

&lt;p&gt;You can see that &lt;a href=&quot;https://termbrowser.nhs.uk/?perspective=full&amp;amp;conceptId1=155023009&quot;&gt;155023009&lt;/a&gt; is inactive - and you can see the same via &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/concepts/155023009&quot;&gt;hermes&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;155023009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effectiveTime&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2002-01-31&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;active&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moduleId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000207008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;definitionStatusId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000074008&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can use this concept’s reference set membership to see how SNOMED thinks we might be able to map into the current version of the terminology:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/concepts/155023009/historical&quot;&gt;http://3.9.221.177:8080/v1/snomed/concepts/155023009/historical&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;900000000000527005&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cc542ff9-d695-52ff-a20b-8091e5b0145b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effectiveTime&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2002-01-31&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;active&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moduleId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000207008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;refsetId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900000000000527005&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;referencedComponentId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;155023009&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;targetComponentId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This end-point picks out only the historical association reference set types and lists them conveniently keyed by the association reference type. This makes it straightforward to follow SAME-AS, REPLACED-BY or POSSIBLY-EQUIVALENT-TO links.&lt;/p&gt;

&lt;p&gt;So here we see that &lt;code class=&quot;highlighter-rouge&quot;&gt;155023009&lt;/code&gt; is linked to &lt;code class=&quot;highlighter-rouge&quot;&gt;24700007&lt;/code&gt; by virtue of a &lt;code class=&quot;highlighter-rouge&quot;&gt;SAME-AS&lt;/code&gt; definition - &lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/concepts/900000000000527005/extended&quot;&gt;900000000000527005&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;pre-process-our-searches-valuesets-and-codelists&quot;&gt;Pre-process our searches, valuesets and codelists&lt;/h3&gt;

&lt;p&gt;Alternatively, when we’re generating a list of codes for our code list, we could reverse this process and look at the modern concept(s) in which we are interested and get back the legacy inactive identifiers that we want to include.&lt;/p&gt;

&lt;p&gt;We can ask hermes to expand any arbitrary SNOMED expression constraint language (ECL) expression:&lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&quot;&gt;http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1223980016&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MS - Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredTerm&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But we can also ask for the expansion to include historical associations:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&amp;amp;include-historic=true&quot;&gt;http://3.9.221.177:8080/v1/snomed/expand?ecl=%3C%3C24700007&amp;amp;include-historic=true&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You’ll see that our expanded codelist now also includes outdated, inactivated concepts from past versions of SNOMED. We can now use this expanded list for our data analytics.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;27239011&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16092000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Cord multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredTerm&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Cord multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30986014&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18353007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Brain stem multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredTerm&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Brain stem multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1223980016&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;conceptId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24700007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;term&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MS - Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preferredTerm&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Multiple sclerosis&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;Managing real-life health and care data is complex; health informatics needs to build software, ideally open-source, that manages some of these complexities.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/wardle/hermes&quot;&gt;Hermes&lt;/a&gt; is a library and microservice that provides some of that capability in relation to SNOMED CT and other terminologies.&lt;/p&gt;

&lt;p&gt;You cannot ignore the issue of managing codes now thought of as inactive, or outdated from your health and care data, but instead you need to think carefully about how to manage change over time.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">There’s a problem with using SNOMED CT for data analytics; in this post, I’ll explain the issue and how to mitigate! If you’re using SNOMED CT for data analytics, you will encounter this issue, and need to handle it!</summary></entry><entry><title type="html">A mistake at REST</title><link href="https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest.html" rel="alternate" type="text/html" title="A mistake at REST" /><published>2021-06-30T16:07:08+01:00</published><updated>2021-06-30T16:07:08+01:00</updated><id>https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest</id><content type="html" xml:base="https://www.wardle.org/ehr/2021/06/30/mistakes-at-rest.html">&lt;p&gt;The HL7 FHIR standard provides a useful model of health and care information, but it is a specification from which a local standard can be built via &lt;em&gt;profiling&lt;/em&gt;. It defines models of data and a specification for how to exchange those data via an architectural pattern called representational state transfer (REST). While there are other ways that data in HL7 FHIR can be exchanged, using REST as an architectural pattern means that software using HL7 FHIR for data exchange will read and write to &lt;em&gt;resources&lt;/em&gt; that represent something in the health and care domain.&lt;/p&gt;

&lt;p&gt;You can read about the RESTful aspects of HL7 FHIR in more detail on the &lt;a href=&quot;https://www.hl7.org/fhir/http.html&quot;&gt;official HL7 FHIR website&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The semantics of that architectural pattern are of reading, or writing, deleting or searching, or doing something else to a resource.&lt;/p&gt;

&lt;p&gt;The problem is that health care doesn’t use that semantic pattern.&lt;/p&gt;

&lt;h1 id=&quot;read-and-write-semantics&quot;&gt;Read and write semantics&lt;/h1&gt;

&lt;p&gt;Medical records are immutable. As I &lt;a href=&quot;/images/cis_design/cis_design.pdf&quot;&gt;wrote in 2017&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;

  &lt;p&gt;Immutability refers to an approach to software engineering in which data are unchangeable. 
Such an approach is particularly suitable when considering medical
records and processes. Indeed, from a medico-legal perspective, all data should
be regarded as immutable as it is usually necessary to be able to view the state of
the record at any point in time.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;/images/cis_design/cis_design.pdf&quot;&gt;Section 5.11, Clinical information system design : Mark Wardle, 2017&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Our paper records accumulate. They accrete.&lt;/p&gt;

&lt;p&gt;We don’t rip out old information.&lt;/p&gt;

&lt;p&gt;New records update and take the place of older records in our &lt;em&gt;decision-making&lt;/em&gt;, but those
older records still exist.&lt;/p&gt;

&lt;p&gt;Of course, most implementations will not actually delete data when when we issue a DELETE against a resource. 
For example, if we issue a DELETE against a resource representing an organisation in our health and care environment, 
the underlying software is likely to effect that change by simply marking that organisation as deleted.&lt;/p&gt;

&lt;p&gt;So what’s the issue?&lt;/p&gt;

&lt;p&gt;It’s that thinking that the &lt;em&gt;model&lt;/em&gt; of data that we use to examine, process and make sense of a health and care record 
is the same as the one that might populate that medical record in the first place.&lt;/p&gt;

&lt;h1 id=&quot;different-models-for-reading-and-writing&quot;&gt;Different models for reading and writing&lt;/h1&gt;

&lt;p&gt;The problem is that the modelling of information used for reading is widely different to that information we record
as a consequence of the processes of care.&lt;/p&gt;

&lt;p&gt;The medical record is not simply a record, but a working &lt;em&gt;tool&lt;/em&gt; that helps professionals and patients make sense and
reduce the uncertainty about a decision, whether that decision is about an individual patient (shall I have that procedure?),
a clinical service (how do we configure our service to best improve outcomes?) or for research (what new knowledge can we gain?).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“You’re a victim of it or a triumph because of it. The human mind
simply cannot carry all the information without error so the record
becomes part of your practice.”
&lt;a href=&quot;https://www.youtube.com/watch?v=qMsPXSMTpFI&quot;&gt;Dr Larry Weed, Internal Medicine Grand Rounds, 1971&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In other complex domains, a pattern of command query responsibility separation (CQRS) has been used in which
the information models of querying (reading) data are separate from those of creating data.&lt;/p&gt;

&lt;p&gt;I would argue that for many situations in health and care, we should build quite different data models for issuing “commands” 
or “actions” than the data models I subsequently use in order to make sense of the record.&lt;/p&gt;

&lt;p&gt;We should move away from REST semantics towards separating how we think about commands from how we think about queries.&lt;/p&gt;

&lt;p&gt;For example, I &lt;em&gt;prescribe&lt;/em&gt; a drug (an action) and that data model, that domain event, is used to populate a view (a query) of all recently prescribed drugs and provide a flattened ‘view’ of a medication list based on those actions. I am not reading and writing a medication list, but the list is built as a consequence of the actions.&lt;/p&gt;

&lt;p&gt;This approach scales well to the medical record, because the medical record should be dominated by &lt;em&gt;reads&lt;/em&gt;. That means it is very easy to optimise reading and processing of data differently to the systems that handle writing.&lt;/p&gt;

&lt;p&gt;It also simplifies our data modelling work - because we can build clinical data models that focus on workflow and process (our actions), and then separately conceive of the best ways to make sense and view the logical record - quite rightly through different ‘prisms’ depending on need.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;</content><author><name></name></author><summary type="html">The HL7 FHIR standard provides a useful model of health and care information, but it is a specification from which a local standard can be built via profiling. It defines models of data and a specification for how to exchange those data via an architectural pattern called representational state transfer (REST). While there are other ways that data in HL7 FHIR can be exchanged, using REST as an architectural pattern means that software using HL7 FHIR for data exchange will read and write to resources that represent something in the health and care domain.</summary></entry><entry><title type="html">The dependencies between architecture, governance and standards.</title><link href="https://www.wardle.org/ehr/2021/06/30/dependency-conway.html" rel="alternate" type="text/html" title="The dependencies between architecture, governance and standards." /><published>2021-06-30T07:07:08+01:00</published><updated>2021-06-30T07:07:08+01:00</updated><id>https://www.wardle.org/ehr/2021/06/30/dependency-conway</id><content type="html" xml:base="https://www.wardle.org/ehr/2021/06/30/dependency-conway.html">&lt;p&gt;I &lt;a href=&quot;/ehr/2019/11/08/learning-from-creating-an-ehr.html&quot;&gt;built an electronic health record and along the way learnt a lot&lt;/a&gt; about how to think about the importance of medical records and &lt;em&gt;data&lt;/em&gt; in my day-to-day work as a practising clinician, manager and researcher.&lt;/p&gt;

&lt;p&gt;At the end of that talk (and post), I touched on the importance of building &lt;em&gt;capability&lt;/em&gt; : in data and the software that use those data - to deliver the outcomes we want in health and care. But what does that mean? What are the capabilities that we need to build, specifically?&lt;/p&gt;

&lt;p&gt;I would argue:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;our capabilities to record, view, manipulate and infer from &lt;em&gt;meaningful data&lt;/em&gt; - for direct care, for managing our services and for research.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;depend upon&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;our capabilities to continually deliver safe, sustainable and secure software at pace.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and we can look to the characteristics of the highest-performing technology teams to understand that these depend upon:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;small, empowered, cross-functional (multi-disciplinary) teams&lt;/li&gt;
  &lt;li&gt;appropriate modularisation, with well-defined contractual (standards-based) interfaces between those modules&lt;/li&gt;
  &lt;li&gt;fast feedback via automated testing and telemetry, monitoring and logging&lt;/li&gt;
  &lt;li&gt;fast feedback from users with iterative, agile working&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and understand, therefore, there is:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;mutual dependency between architecture, governance and standards&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;because our capabilities are determined by our teams and how they can work effectively, and that means building an architecture that breaks down our problems into solvable chunks, making sure that governance is streamlined and effective so that there are clear lines of responsibility and defining the interactions between teams and the products for which they are responsible via open published standards as one part of the contractual obligations between those teams and products.&lt;/p&gt;

&lt;h1 id=&quot;building-products-delivering-outcomes--choose-team-first-boundaries&quot;&gt;Building products delivering outcomes : “Choose team-first boundaries”&lt;/h1&gt;

&lt;p&gt;Truly, our architecture and governance are mutually-dependent with &lt;em&gt;technical standards&lt;/em&gt; as an integral part of the wider contracts between our modules and consequently, between our teams.&lt;/p&gt;

&lt;p&gt;It makes little sense to govern programmes of work without respecting architectural boundaries; indeed, I would argue that many of the issues facing health and care services in Wales are as a result of ignoring this issue - such as thinking that it is appropriate to govern projects relating to patients and their interactions with services separately to projects relating to professionals, when in fact both &lt;em&gt;programmes&lt;/em&gt; of work share many core building blocks, such as citizen identity.&lt;/p&gt;

&lt;p&gt;So instead need to recognise the importance of constructing &lt;em&gt;empowered teams&lt;/em&gt; to help us solve the problems we face and organise those teams into specific programmes of work.&lt;/p&gt;

&lt;p&gt;The mantra must surely be:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;long-lived products within dynamic flexible programmes,&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;“Flow is difficult to achieve when each team depends on a complicated web of interactions with many other teams. For a fast flow of change to software systems, we need to remove hand-offs and align most teams to the main streams of change within the organization. However, many organizations experience huge problems with the responsibility boundaries assigned to teams. Typically, little thought is given to the viability of the boundaries for teams, resulting in a lack of ownership, disengagement, and a glacially slow rate of delivery.”&lt;/p&gt;

  &lt;p&gt;Skelton, Matthew. Team Topologies (Kindle Locations 2147-2151). IT Revolution Press. Kindle Edition.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So how do we find the &lt;em&gt;fracture planes&lt;/em&gt; within our truly complex and heterogeneous systems?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“A fracture plane is a natural seam in the software system that allows the system to be split easily into two or more parts. This splitting of software is particularly useful with monolithic software. The word monolith itself comes from Greek, meaning “single stone.” Traditional stonemasons hit stones at particular angles to split the rocks in clean segments, taking advantage of their natural fracture planes. We can look for similar fracture planes in software to find the natural split points that lead to software boundaries.”&lt;/p&gt;

  &lt;p&gt;Skelton, Matthew. Team Topologies (Kindle Locations 2226-2227). IT Revolution Press. Kindle Edition.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Too often, software architecture and system design occurs as a consequence of organisational or management structures, rather than stepping back and truly understanding the problem domain and how to carve it up into manageable chunks. You need to understand Conway’s Law, and the reverse Conway’s manoevre - and place the patient foremost in the design and architecture of your systems.&lt;/p&gt;

&lt;p&gt;Mark&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;

  &lt;p&gt;This post was originally written in November 2019.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name></name></author><summary type="html">I built an electronic health record and along the way learnt a lot about how to think about the importance of medical records and data in my day-to-day work as a practising clinician, manager and researcher.</summary></entry><entry><title type="html">Decomposing the electronic health and care record</title><link href="https://www.wardle.org/patientcare/2021/03/28/next-steps-epr.html" rel="alternate" type="text/html" title="Decomposing the electronic health and care record" /><published>2021-03-28T10:09:09+01:00</published><updated>2021-03-28T10:09:09+01:00</updated><id>https://www.wardle.org/patientcare/2021/03/28/next-steps-epr</id><content type="html" xml:base="https://www.wardle.org/patientcare/2021/03/28/next-steps-epr.html">&lt;p&gt;So I built an electronic patient record system that’s been running since 2007. It was, as far as I am aware, the first implementation of SNOMED CT in a live clinical system. Most users have never known that SNOMED is its &lt;em&gt;lingua franca&lt;/em&gt;, and most think it is a bespoke ‘database’ for their use, because
I built multiple subject and specialty-specific “prisms” through which to see, what is essentially,
a single record.&lt;/p&gt;

&lt;p&gt;There is no better iterative fast feedback loop than being a user as well as a developer. It is difficult to know what works and what doesn’t work without an exploratory phase of design and implementation.&lt;/p&gt;

&lt;p&gt;That software now supports the care of thousands of patients across Wales, over 126000 lines of code and on today’s estimates would cost $6 million to develop.&lt;/p&gt;

&lt;p&gt;But as with any large software application, it’s starting to become more difficult to make changes. Early design decisions accelerated progress but are unduly limiting now. Early assumptions about how and where the application might be used are now proven wrong.&lt;/p&gt;

&lt;p&gt;Such issues are common in all software projects.&lt;/p&gt;

&lt;p&gt;In NHS Wales, we have made amazing progress on some core national services solving difficult problems; we now have services for shared clinical documents, investigation results such as laboratory and radiology as well as a national staff directory and an enterprise master patient index providing a single cross-organisation view of patient identity.&lt;/p&gt;

&lt;p&gt;But the clinical application that staff use to access data in those services - Welsh Clinical Portal - will never be an electronic patient record. Early design decisions have bound it tightly to the local patient administrative system in each organisation and tight-coupling means that changes are difficult to make, and some health boards have requests for change that have waited years to be implemented.&lt;/p&gt;

&lt;p&gt;It is time we modernised the way we think about and develop health and care technology.&lt;/p&gt;

&lt;p&gt;One of the most effective ways of doing that is to recognise the benefits of modularisation, in which we break apart the problems we face to make them easier to solve and recompose those modules in interesting ways in order to solve problems for professionals and patients.&lt;/p&gt;

&lt;p&gt;Understanding how and when to modularise requires significant technical and domain knowledge taking into account existing legacy services and the commercial market. We can use open technical standards to decouple those components. This is one way that we can pay down some of the technical debt built up over years.&lt;/p&gt;

&lt;p&gt;The NHS Wales Informatics Service is being transformed into a new statutory body on 1st April 2021.&lt;/p&gt;

&lt;p&gt;Now is the ideal opportunity for it to become the digital platform on which we build a seamless, effective and safe health and care service for Wales.&lt;/p&gt;

&lt;p&gt;It can and should be a provider of national shared services - much like Amazon has “Amazon Web Services” - with small, long-lived teams of experts providing a range of data and software services as well as support for provider organisations to make use of those services to improve their services.&lt;/p&gt;

&lt;p&gt;Its mission cannot simply be “driving change” in the health service - there’s plenty of evidence that health boards are desperate to improve services using digital technology - it must be focusing on the work that can and should be shared across health and care in Wales - and working to &lt;em&gt;enable&lt;/em&gt; change by the provision of a suite of &lt;em&gt;open&lt;/em&gt; data and computing services.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">So I built an electronic patient record system that’s been running since 2007. It was, as far as I am aware, the first implementation of SNOMED CT in a live clinical system. Most users have never known that SNOMED is its lingua franca, and most think it is a bespoke ‘database’ for their use, because I built multiple subject and specialty-specific “prisms” through which to see, what is essentially, a single record.</summary></entry><entry><title type="html">Building a ‘neuro-rehabilitation database’</title><link href="https://www.wardle.org/strategy/2020/07/31/solving-problems-by-composition.html" rel="alternate" type="text/html" title="Building a 'neuro-rehabilitation database'" /><published>2020-07-31T16:15:15+01:00</published><updated>2020-07-31T16:15:15+01:00</updated><id>https://www.wardle.org/strategy/2020/07/31/solving-problems-by-composition</id><content type="html" xml:base="https://www.wardle.org/strategy/2020/07/31/solving-problems-by-composition.html">&lt;p&gt;I built an electronic patient record and it’s been quite successful. It’s taught me a great deal about how to recognise how to modularise and decouple different data and software components. It’s been running since 2009 and is in live use.&lt;/p&gt;

&lt;p&gt;It’s a large project, and I can’t conceive of everything in one go, so even though I’m the only developer, adopting an architecture that enables modularity, adaptability and flexibility is important.&lt;/p&gt;

&lt;p&gt;One important aspect of my work is being able to compose individual building blocks together to solve problems, and to do that in a declarative, rules-based way. This means I can build solutions have them deployed and working in live clinical environments in less than a day.&lt;/p&gt;

&lt;p&gt;Most users think that the software is designed for them, and in a way it is. People refer to it as the “MS database” or the “referrals database” or the “Parkinson’s database” or the “MND database” but each is simply a prism through which to view a single digital patient record.&lt;/p&gt;

&lt;p&gt;To illustrate the point, it’s quite easy to see the common foundational services:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Patient identity - lookup arbitrary identifiers such as any Welsh hospital identifier or NHS number or search (Google-like) by name&lt;/li&gt;
  &lt;li&gt;Staff identity and authentication - including lookup and email via the NHS Wales active directory service&lt;/li&gt;
  &lt;li&gt;Finely-grained access control by the runtime registration of both patients and users to clinical services, teams and research projects&lt;/li&gt;
  &lt;li&gt;Tracking episodes of care and configurable encounters and data-collection forms.&lt;/li&gt;
  &lt;li&gt;Clinical terminology, value set management and organisational data services&lt;/li&gt;
  &lt;li&gt;Document creation and publication services, to create documents from data and publish those in local and national document management services such as Cardiff clinical portal and Welsh Clinical Portal.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With these building blocks, let’s build a neuro-rehabilitation database. I’m going to live blog this work.&lt;/p&gt;

&lt;h1 id=&quot;neuro-rehabilitation&quot;&gt;Neuro-rehabilitation&lt;/h1&gt;

&lt;p&gt;When I designed the system, I recognised I’d need to make it easy to change the things that would change. Registering a new logical service or research project had to be easy and involve no software code. In fact, I wanted to ensure that I could configure lots of things at runtime, and I made SNOMED CT the lingua franca. If I need to write code, I wanted to make it as modular as possible and ensure that first changes didn’t affect what was already working and second, that I didn’t have to make changes anywhere else.&lt;/p&gt;

&lt;p&gt;The neuro-rehabilitation team wanted to track a cohort of patients and make assessments about their rehabilitation need.&lt;/p&gt;

&lt;p&gt;So I can create a new service using my administration portal:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/create-project.png&quot; alt=&quot;Create Project&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I can configure a project either as a clinical service or a research project. These have different semantics but all are organised in a hierarchical fashion so that properties are inherited from parent projects, and that users and patients are linked to services and projects via registration or episodes of care, and that means when you as a user search for John Smith, you’ll only get patients known to one of your registered services.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/no-permission.png&quot; alt=&quot;No Permission&quot; /&gt;&lt;/p&gt;

&lt;p&gt;For a service or project, I can configure common SNOMED concepts so that drop-downs and picklists and autocompletion boxes get configured based on who you are and who you are seeing. This means users feel as if the system is designed for them, even if really it’s just simple configuration. I configure the specialty using SNOMED-CT.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/choose-common-concepts.png&quot; alt=&quot;Choose Common Concepts&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I wanted users to be able to manage their own services, so all projects have per-project security permissions. This means I don’t need to be involved in registering users, and all “power users” need to do is type in a username and the software fetches their details from the national directory.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/choose-users.png&quot; alt=&quot;Choose Users&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Each service can have different types of encounter. This is usually dependent on the service or project at hand, so is very customisable. Here I’ve simply created three for now, ‘correspondence’, ‘inpatient review’, and ‘telephone call’.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/configure-encounters.png&quot; alt=&quot;Configure Encounters&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And for each, I configure some common forms. Users can manually record others, but this streamlines the process for them. Each encounter can be associated with fetching lists from external systems such as PAS making it useful for clinics.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/configure-an-encounter.png&quot; alt=&quot;Configure An Encounter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here I add a medication review (this used dm+d to record medications and changes to medications), a procedure form (useful for recording stuff done), a botulinum toxin form (a specialised procedure form), a MOCA (a cognitive test), and a rehabilitation assessment form.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/configure-forms.png&quot; alt=&quot;Configure Forms&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Data collection forms are linked to encounters, which are linked to episodes, which are linked to patients. Each episode is linked to a project or service, and each project or service has a list of registered users. It’s quite straightforward to see how I implement finely-grained information governance using this model. Each user thinks the system is designed for them.&lt;/p&gt;

&lt;p&gt;Here’s the rehabilitation assessment form. Its contents are automatically populated from information already in the electronic record, but users can make changes and then save. Diagnoses are recorded using SNOMED CT so later we can stratify our patient group by category of injury for example.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/configure-rehab-form.png&quot; alt=&quot;Configure Rehab Form&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can add arbitrary validation so that we help users enter the right information:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/rehab-assessment-outcome.png&quot; alt=&quot;Rehab Assessment Outcome&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We already have a “botulinum toxin database”, so I can simply re-use that form for this service. Some rehabilitation patients need injections of botulinum for spasticity or jaw problems.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/botulinum-toxin-form.png&quot; alt=&quot;Botulinum Toxin Form&quot; /&gt;&lt;/p&gt;

&lt;p&gt;All these data are coded using SNOMED CT, even when you’re simply clicking on a diagram.&lt;/p&gt;

&lt;p&gt;I have lots of pre-built forms and it can take between 5 minutes and an hour or so to build a new one, depending on complexity. So other modules don’t have to understand the data within each form, forms generate SNOMED CT artefacts that can be used to dynamically configure the user interface depending on need.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/list-forms.png&quot; alt=&quot;List Forms&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Each project or service can send clinical documents to other document repositories. I configure a “report” using a PDF template that will watermark the generated document. The document is generated from data. It’s a shame but none of the receiving document repositories can yet understand the structured information encoded with these documents, but accept only a PDF and a small amount of non-standard metadata.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/configure-reports.png&quot; alt=&quot;Configure Reports&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once configured, users can create reports from their encounters.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/publish-report.png&quot; alt=&quot;Publish Report&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;understanding-the-neuro-rehab-service&quot;&gt;Understanding the neuro-rehab service&lt;/h1&gt;

&lt;p&gt;But now we have those data, we can slice and dice in order to help users understand their service.&lt;/p&gt;

&lt;p&gt;In neurorehabilitation, the team want to understand who is in their active cohort, and understand those patients who need further review, as well as identify those ready for transfer. I can configure a “home page” for each service to provide a flexible modular system to show the right information at the right time.&lt;/p&gt;

&lt;p&gt;This is what it looks like for neuro-rehabilitation:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/neurorehab/understand-and-improve-data.png&quot; alt=&quot;Understand And Improve Data&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Not only do the team get to see who is in the cohort without a current assessment, but also stratify based on location and status, the screen updating as different criteria are chosen.  If the team want even greater flexibility, they can download a spreadsheet of data, by default with patient identifiable information removed.&lt;/p&gt;

&lt;p&gt;This took just about six hours to go from inception to deployment, mainly because I’m able to simply stitch together foundational components to solve specific problems.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">I built an electronic patient record and it’s been quite successful. It’s taught me a great deal about how to recognise how to modularise and decouple different data and software components. It’s been running since 2009 and is in live use.</summary></entry><entry><title type="html">Getting health and care data back to front</title><link href="https://www.wardle.org/strategy/2020/07/29/central-data-and-the-epr.html" rel="alternate" type="text/html" title="Getting health and care data back to front" /><published>2020-07-29T16:15:15+01:00</published><updated>2020-07-29T16:15:15+01:00</updated><id>https://www.wardle.org/strategy/2020/07/29/central-data-and-the-epr</id><content type="html" xml:base="https://www.wardle.org/strategy/2020/07/29/central-data-and-the-epr.html">&lt;p&gt;In most health and care economies, it’s really important to be able to feed back data in order to inform and assess policy as part of central reporting.&lt;/p&gt;

&lt;p&gt;I’ve written previously about health and care central reporting requirements, and that such data returns are helpful and important but must be regarded as simply one ‘prism’ through which to ‘see’ a patient record.&lt;/p&gt;

&lt;p&gt;It’s good to see a specific example, so have a look at the &lt;a href=&quot;https://www.wales.nhs.uk/sites3/documents/742/Site%20Specific%20Cancer%20Reporting%20July%202.pdf&quot;&gt;NHS Wales breast cancer reporting requirements&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/cancer-reporting.png&quot; alt=&quot;Cancer Reporting&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This dataset is a summary of the important aspects of breast cancer care and is vital for planning and improving services. It should also be used to &lt;em&gt;inform&lt;/em&gt; operational data collection.&lt;/p&gt;

&lt;p&gt;However, it’s important that those requirements don’t dictate &lt;em&gt;how&lt;/em&gt; that collection should be made.&lt;/p&gt;

&lt;p&gt;That link reflects version 4.1 of the reporting requirements; requirements change and any digital systems supporting those reporting requirements needs to be able to adapt and flex accordingly.&lt;/p&gt;

&lt;h1 id=&quot;rectangles-and-projections&quot;&gt;Rectangles and projections&lt;/h1&gt;

&lt;p&gt;But can we use central reporting requirements to design our clinical information systems?&lt;/p&gt;

&lt;p&gt;Many central data reporting requirements want data to be representing in &lt;em&gt;rectangles&lt;/em&gt;. That’s a bit like looking at patient data through the prism of a spreadsheet, such as Microsoft Excel.&lt;/p&gt;

&lt;p&gt;This is not dissimilar to cartography where a map projection takes the richness, splendour and complexity of a globe’s surface and projects it onto a two-dimensional surface for your atlas. In cartography, multiple projections are available that suit different purposes, each compromising the original information in some way. Each of those representations also create their own value -  a two-dimensional map can be printed or shown on your flat screen - they are useful representations, but they’re not the &lt;em&gt;truth&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Knowing how our health and care data will be used by policy-makers is critical in designing compelling clinical information systems, but we need operational, day-to-day clinical data to solve &lt;em&gt;multiple purposes&lt;/em&gt; - direct care, management / policy and research.&lt;/p&gt;

&lt;h1 id=&quot;data-entry-weve-got-things-backwards&quot;&gt;Data-entry; we’ve got things backwards!&lt;/h1&gt;

&lt;p&gt;Unfortunately, to meet the demands of central data reporting, it is commonly the case, even in 2020, that data-entry, whether for cancer or for conditions such as stroke, is done after-the-event by someone whose job it is to collect the data and complete the returns. It’s retrospective, labour-intensive and error prone. It’s often the same for research; a separate methodology rather than a difference of acuity.&lt;/p&gt;

&lt;p&gt;Sadly, the data is not entered as a function of the process of care.&lt;/p&gt;

&lt;p&gt;But it should be clear from the reporting requirements that most of the required information can and should actually be sourced from operational systems, if only one could build adaptable systems that prioritise meaningful data and can be stitched together and used as a source of meaningful information from which the right information can be plucked in order to make decisions.&lt;/p&gt;

&lt;p&gt;So how can we make data a function of the process of care?&lt;/p&gt;

&lt;h1 id=&quot;funnels-the-opportunity-of-decision-points&quot;&gt;Funnels: the opportunity of decision-points&lt;/h1&gt;

&lt;p&gt;For example, the multi-disciplinary team (MDT) meeting is an opportunity for the aggregation, validation and input of decision-critical information. It’s easy to see the MDT as a funnel, and this doesn’t only apply to cancer, but any complex decision making such as epilepsy surgery or neurovascular disease in which multiple facets of information need to be understood by a multi-disciplinary team.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/info-in-action-out.png&quot; alt=&quot;Info In Action Out&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Indeed, the MDT is a microcosm of all clinical encounters, even when there’s only one professional involved. The funnel model is applicable to all clinical encounters.&lt;/p&gt;

&lt;p&gt;Each clinical encounter is an opportunity to bring together disparate information, synthesise, formulate and plan. We need to not only capture that process but build technology that can make it as effective as possible. That means supporting both ends of the funnel - making the right information at the right time and supporting clinical synthesis and the ongoing orchestration and coordination of clinical care.&lt;/p&gt;

&lt;h1 id=&quot;on-data-and-decisions&quot;&gt;On data and decisions&lt;/h1&gt;

&lt;p&gt;The problem with data in health and care is that there is no such thing as a single source of truth.&lt;/p&gt;

&lt;p&gt;This manifests even for what might be perceived as simple such as a patient’s address. Is that address the address for correspondence, the address of the parent, the term-time address or the address from which the patient moved from last year?&lt;/p&gt;

&lt;p&gt;It’s even more difficult for clinical data. Terms such as ‘diagnosis’ might not sound difficult but are fundamentally defined by &lt;em&gt;context&lt;/em&gt;. A diagnosis of angina made by me is very different to that made by a cardiologist! Even our diagnostic tests are imperfect measures of the ‘truth’ with false positives and false negatives and repeated tests that give different results.&lt;/p&gt;

&lt;p&gt;Even the diagnostic process isn’t what might be imagined. We don’t record what we find and then work out the most likely diagnosis. We do it in reverse! The diagnosis informs what information we collect and how we examine! It’s iterative and internally correlated.&lt;/p&gt;

&lt;p&gt;Even prescribing information is imperfect. Did the patient actually take that drug at all? Sometimes not at all.&lt;/p&gt;

&lt;p&gt;And look at how much information we might have. Is that step-count data, or home blood pressure monitoring data useful for informing our decisions? What tools do we have to make sense of burgeoning information from multiple sources? We can be overwhelmed with too much information.&lt;/p&gt;

&lt;p&gt;It’s much better to see clinical data for what it is and use it appropriately - we’re looking at the truth through the corner of our eyes, our data an imperfect imprint of the truth. We’re creating &lt;em&gt;models&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Ultimately, there’s uncertainty surrounding all of our decisions, and our data can help to reduce that uncertainty. Usually that’s by bringing different sources of information together.&lt;/p&gt;

&lt;h1 id=&quot;information-at-the-right-time&quot;&gt;Information at the right time&lt;/h1&gt;

&lt;p&gt;So we need software and systems driven by &lt;em&gt;data&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;That means a digital health and care patient record is much more that a flat list of documents with little or no accurate metadata.&lt;/p&gt;

&lt;p&gt;But we shouldn’t ignore documents either. They have some important positive characteristics:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;They can and should carry their own context; they can (usually) be read standalone&lt;/li&gt;
  &lt;li&gt;They reflect a snapshot of ‘state’ and thinking at a time-point&lt;/li&gt;
  &lt;li&gt;They are immutable, so don’t change after the event - if a change is needed a new document should be issued.&lt;/li&gt;
  &lt;li&gt;They support processes of care - because while they also a type of record, they &lt;em&gt;move around&lt;/em&gt; and so can be used to activate different workflows.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The fact that documents &lt;em&gt;move around&lt;/em&gt; is really important. They are a driver of much &lt;em&gt;tacit&lt;/em&gt; process and workflow. We have many unstated assumptions in health and care and one of our jobs is to understand their existence and their importance.&lt;/p&gt;

&lt;p&gt;It’s better to see documents are the artefacts of care. Just like data for central reporting, we have things back to front and should be generating our documents and cascading workflow from our processes of care, and not the other way around.&lt;/p&gt;

&lt;p&gt;The medical record isn’t a simple record of what happened but a tool that helps us formulate, plan, communicate and deliver care. It’s a tool. “You’re a victim of it or a triumph because of it. The human mind simply cannot carry all the information without error so the record becomes part of your practice” (Larry Weed, 1971 - see &lt;a href=&quot;https://wardle.org/cis-design/2017/05/01/medical-record.html&quot;&gt;https://wardle.org/cis-design/2017/05/01/medical-record.html&lt;/a&gt;)&lt;/p&gt;

&lt;h1 id=&quot;effective-software-development&quot;&gt;Effective software development&lt;/h1&gt;

&lt;p&gt;The breast cancer data collection requirements potentially teach us a lot; the essence of those requirements has broad applicability to other diseases, whether cancer or not.&lt;/p&gt;

&lt;p&gt;It’s so important to have a strong vision for how we want the future to look, and how we want to enable data to drive patient care, service improvement and research, but there’s a paradox in technology, in that the best way to deliver technology is to break apart the big problems that you’re trying to solve and then &lt;em&gt;compose&lt;/em&gt; the solutions together again. We have to think big but work small and iterate.&lt;/p&gt;

&lt;p&gt;Composability is fundamental to the next generation of electronic health and record systems.&lt;/p&gt;

&lt;p&gt;And we also need to be sufficiently confident in our understanding of technology that we call out the hubris when someone provides an 18-month plan for how to deliver intangible benefits. We have to be able to stand up and say that this bit is a hard problem and we’ll need to explore different ways of solving that, and understand that we will fail.&lt;/p&gt;

&lt;p&gt;Paradoxically, working incrementally in the small is less risky than following an 18-month plan. Planning is good, but our plans will change and adapt as we learn.&lt;/p&gt;

&lt;p&gt;It’s seductive to think otherwise, and pretty difficult to sell “we don’t know” as a tagline. Perhaps you don’t get appointed to a job if you say we “don’t have all of the answers”.&lt;/p&gt;

&lt;p&gt;Of course, there’s a lot we do know, and one size doesn’t fit all in technology, whether we’re talking about approach, standards, ‘buy vs build’ (should we buy the solution to this problem off the shelf or build it ourselves?) or any other facet of ‘digital’, and so we need to see the fracture lines and break-apart our problem domain and get on with delivering appropriate solutions or starting the graft of learning how to solve problems in that domain.&lt;/p&gt;

&lt;p&gt;We need to be &lt;em&gt;agile&lt;/em&gt;.&lt;/p&gt;

&lt;h1 id=&quot;deliver-better-and-faster-by-doing-things-right&quot;&gt;Deliver better and faster by doing things right&lt;/h1&gt;

&lt;p&gt;We can speed up delivery of valuable digital tools and technology by adopting the right approach. We should stack the odds of being successful in our favour. There are many examples where will fail to do this.&lt;/p&gt;

&lt;p&gt;So let’s return to breast cancer. What can we learn from this?&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Central reporting helps us understand what is important from policy-makers.&lt;/li&gt;
  &lt;li&gt;Data should be sourced from results of the processes of care.&lt;/li&gt;
  &lt;li&gt;Operational systems should focus on &lt;em&gt;meaningful data&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;We need to adopt a modular, de-coupled and agile approach to health and care software and data.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;It’s not difficult to see the sources of information that we need for breast cancer reporting - demographic data links a patient with different identifiers across organisations, appointments and scheduling provides a virtual scaffold for the ‘when’ and ‘how’ things have happened via different pathways, laboratory and radiology data brought together help understand the pathology and its extent (staging), and finally, at MDT, we need tools to validate and refine those ‘inputs’, record the decision-making and plan the next steps in care.&lt;/p&gt;

&lt;p&gt;In fact, those requirements for breast cancer are not much different for any other illness either.&lt;/p&gt;

&lt;p&gt;And that tells us what we need to be building for the next generation of electronic health and care record systems.&lt;/p&gt;

&lt;p&gt;And how can we deliver a compelling and credible plan to build that technology that will underpin our ambitions for health and care in Wales?&lt;/p&gt;

&lt;p&gt;National governance arrangements and technical architecture need to ensure that we reduce the need for constant coordination between different groups.&lt;/p&gt;

&lt;p&gt;We’ve failed if we need everyone ‘in the room’!&lt;/p&gt;

&lt;p&gt;We need to instead:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;decouple and modularise, to permit parallel independent working at pace&lt;/li&gt;
  &lt;li&gt;use open technical standards to define the interfaces between modules&lt;/li&gt;
  &lt;li&gt;avoid single repositories and instead use shared vocabularies&lt;/li&gt;
  &lt;li&gt;develop an unremitting focus on &lt;em&gt;data&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;foster greater use of off-the-shelf cloud providers and move to &lt;em&gt;abstract&lt;/em&gt; our infrastructure&lt;/li&gt;
  &lt;li&gt;define clear lines of responsibility for different services, and include performance  and reliability metrics.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">In most health and care economies, it’s really important to be able to feed back data in order to inform and assess policy as part of central reporting.</summary></entry><entry><title type="html">Advancing civilisation</title><link href="https://www.wardle.org/strategy/2020/07/17/advancing-civilisation.html" rel="alternate" type="text/html" title="Advancing civilisation" /><published>2020-07-17T09:09:10+01:00</published><updated>2020-07-17T09:09:10+01:00</updated><id>https://www.wardle.org/strategy/2020/07/17/advancing-civilisation</id><content type="html" xml:base="https://www.wardle.org/strategy/2020/07/17/advancing-civilisation.html">&lt;blockquote&gt;
  &lt;p&gt;“Civilization advances by extending the number of important operations which we can perform without thinking about them.”&lt;/p&gt;

  &lt;p&gt;Alfred North Whitehead.&lt;/p&gt;

  &lt;p&gt;An Introduction to Mathematics (1911)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Our job in digital health and care is&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;to use data as the foundation to our health and care services,&lt;/li&gt;
  &lt;li&gt;to understand how to modularise our computing and data services&lt;/li&gt;
  &lt;li&gt;in order to &lt;em&gt;compose&lt;/em&gt; those modules back together in interesting ways to solve problems&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We should be designing with data and composable, modular, de-coupled, re-usable, stateless computing services that can act on those data.&lt;/p&gt;

&lt;p&gt;Together, they are the building blocks, the foundation stones of a pyramid. Each level of that pyramid reflects a higher-level of abstraction, providing more sophisticated solutions to our health and care problems.&lt;/p&gt;

&lt;p&gt;At the lowest levels are the core foundational services such as patient identity.&lt;/p&gt;

&lt;p&gt;At the highest levels, we will be solving our most nefarious problems, and not thinking about the low-level abstractions we already have in place.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">“Civilization advances by extending the number of important operations which we can perform without thinking about them.” Alfred North Whitehead. An Introduction to Mathematics (1911)</summary></entry><entry><title type="html">Semantic value sets</title><link href="https://www.wardle.org/standards/2020/07/09/value-sets.html" rel="alternate" type="text/html" title="Semantic value sets" /><published>2020-07-09T09:09:10+01:00</published><updated>2020-07-09T09:09:10+01:00</updated><id>https://www.wardle.org/standards/2020/07/09/value-sets</id><content type="html" xml:base="https://www.wardle.org/standards/2020/07/09/value-sets.html">&lt;p&gt;One of the difficulties with building semantic interoperability between clinical systems is how we define value sets.&lt;/p&gt;

&lt;p&gt;In essence, a value set is a set of values that can be used for a data field. It is a vocabulary.&lt;/p&gt;

&lt;p&gt;Many health interoperability technologies leave value sets as something to be &lt;em&gt;profiled&lt;/em&gt;. This means that one actually can’t exchange meaningful information unless you agree on what you are using for a particular field. In many cases that means you can talk, but you’re both talking different languages.&lt;/p&gt;

&lt;p&gt;Often value sets model real-world operations very closely. Sometimes, they don’t because
they reflect central reporting requirements and act as a classification system rather than a terminology. You can learn a lot by asking yourself who is the primary user of that value set.&lt;/p&gt;

&lt;p&gt;The best way to think of this, in a non-technical manner, is that for central reporting we might want to categorise a clinical encounter by main specialty (e.g. neurology), but in fact the patient was really seen by a number of different specialties or clinicians in subspecialty practice (e.g. epilepsy surgery pre-assessment clinic). The reporting is important, but it is a prism through which we view the record in order to simplify our analytics. It isn’t the “truth”.&lt;/p&gt;

&lt;p&gt;It should be obvious that a flat classification system is great for reporting, because you categorise patients into groups, but an ontology does much more. Ontologies not only provides value lists but provides information about how each value relates to one another. For example,  paediatric neurology &lt;code class=&quot;highlighter-rouge&quot;&gt;is-a&lt;/code&gt; paediatric speciality, paediatric neurology &lt;code class=&quot;highlighter-rouge&quot;&gt;is-a&lt;/code&gt; neurology specialty). That makes ontologies much better for operational clinical systems.&lt;/p&gt;

&lt;p&gt;It’s seductive to use an information standard for operational systems (“we’ve used a standard”), and sometimes that’s the right approach. More often, it’s much better to define the value set in terms of an ontology.&lt;/p&gt;

&lt;p&gt;The logical consequence is that we need systems that can transparently flip between different classification and ontology systems. When we can do that with losing information, it is called ‘round-tripping’, but in many cases it’s not possible to map without losing information because a classification simply doesn’t have the necessary level of granularity. The logical consequence of that is that we should do most of our work in a finely-grained terminology that has an ontological basis and map to less granular, lossy classification schemes for reporting purposes.&lt;/p&gt;

&lt;p&gt;Any national data project in health and care needs to give careful consideration to how to process data. In general, real-life health and care data is granular, hierarchical, graph-like and complex, while many central reporting requirements prefer a simpler tabular, categorised view.&lt;/p&gt;

&lt;p&gt;This example here using real code, in Clojure, to demonstrate how we can build stable, reliable clinical systems that can seamlessly switch between ontological value sets and classification value sets, and sometimes back again. This example uses a value set that is useful both for reporting and operationally: triage category.&lt;/p&gt;

&lt;p&gt;I’ve deliberately chosen this as we can round-trip without losing information.&lt;/p&gt;

&lt;p&gt;This is my real-time write up of coding some simple logic to handle mapping between different value sets. I wrote it in the space of an afternoon, so it’s only a demonstration. The code is trivial - 32 lines of actual code. The declarative data definitions and maps are the important thing here.&lt;/p&gt;

&lt;p&gt;It’s written in Clojure, a lisp than runs on the Java virtual machine (JVM). It makes it very easy to do coding in an exploratory way. This is my first live-coding blog in Clojure. It’s an experiment to show how easy it is to map between identifiers if we have our classifications published in a machine readable format with appropriate namespacing.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ns&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com.eldrix.janus.standards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;a-worked-example-triage-category&quot;&gt;A worked example: triage category&lt;/h1&gt;

&lt;p&gt;Here’s our NHS Wales information standards data from the emergency department dataset. It should be a goal for us to publish datasets like this in a format that can be read by machines but that’s not available, so I’ve created a machine-readable version here.&lt;/p&gt;

&lt;p&gt;It defines a value set for triage categories, representing the patient’s priority in an emergency system at time of triage.&lt;/p&gt;

&lt;p&gt;Note that I’ve added a namespace. This means that the combination of namespace and value is globally unique.&lt;/p&gt;

&lt;p&gt;One job for data standards is to define publicly accessible namespaces and their values.
This means that &lt;code class=&quot;highlighter-rouge&quot;&gt;https://data.standards.cymru/Id/datasets/edss/triage|02&lt;/code&gt; will be “very urgent”. It’s impossible to process the code “02” by itself - you have to have insider knowledge of a table structure and what it means. Namespacing codes means that they can standalone and be interpreted appropriately. I’ve made up that namespace - but these need to be published well-known namespaces.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datasets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;These are the NHS Wales data dictionary datasets. 
  See http://www.datadictionary.wales.nhs.uk
  Ideally these should be imported from a machine-readable source, 
  but that doesn't yet exist&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:emergency-department-dataset&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Emergency department dataset&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:url&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.wales.nhs.uk/sitesplus/documents/299/20090401_DSCN_022009%28W%29.pdf&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:dscn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;DSCN (2009) 02 (W)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:items&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
               &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:triage-categories&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Triage categories&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:values&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;01&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Priority One - Immediate&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1064891000000107&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                             &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;02&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Priority Two - Very urgent&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1064911000000105&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                             &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;03&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Priority Three - Urgent&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1064901000000108&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                             &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;04&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Priority Four - Standard&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1077241000000103&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                             &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;05&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Priority Five - Non urgent&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1077251000000100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                             &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;06&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:active&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                              &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;See and Treat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]}}}})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a fragment of the larger dataset, and only includes the triage categories. The code below works for other defined categories in other datasets within the NHS Wales information standards catalogue.&lt;/p&gt;

&lt;p&gt;You can see that I’ve included a map to SNOMED CT for each category. There isn’t an equivalent for “See and treat” so we need to raise this with SNOMED International. (It is also where NHS Wales diverges in its standard from NHS England).&lt;/p&gt;

&lt;p&gt;We need some helper functions to process these information. You don’t need to understand how these work. Skip if you can’t read lisp! This is a toy implementation just to show the logic.&lt;/p&gt;

&lt;p&gt;Clojure allows arbitrary structures to be used as keys and values in associative arrays (also called dictionaries or hash-maps). This means I use tuples here as a key to permit toy lookup functionality. This doesn’t provide real ontological inference - only providing equivalence.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;categories-&amp;gt;ns&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Convert a list of categories into namespaced identifiers&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:values&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hash-map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;all-identifiers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Return a simple list of all identifiers from the datasets&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;vals&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;vals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;categories-&amp;gt;ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;defonce&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;atom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg-equiv-asymm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Registers equivalence from one identifier to another&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;swap!&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg-equiv&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Register that the specified identifiers, expressed as {:system :value}
  are equivalent, symmetrically&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reg-equiv-asymm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reg-equiv-asymm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So now we can process our machine-readable dataset, and simply register that one identifier from one classification or terminology is equivalent to another. Let’s do that now for our triage category. In a real production system, we’d use a service that provided an abstract ontological service and could provide an inference engine off-the-shelf.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg-datasets-snomed&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Register SNOMED maps for the value sets (categories) from the items 
  in the datasets&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datasets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;doall&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;all-identifiers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datasets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
              &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reg-equiv&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://snomed.info/sct&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:info.snomed/sct&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)})))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We’ve registered a symmetric map between SNOMED CT and the dataset definitions from the NHS Wales information standards. Real ontologies provide many more options to define relationships between identifiers.&lt;/p&gt;

&lt;p&gt;Let’s double check that this works by round-tripping between our triage identifier and SNOMED CT and back&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reg-datasets-snomed&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datasets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get-in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;05&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://snomed.info/sct&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;;-&amp;gt; returns =&amp;gt; {:system &quot;https://snomed.info/sct&quot;, :value 1077251000000100}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get-in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://snomed.info/sct&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1077251000000100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; -&amp;gt; returns =&amp;gt; {:system &quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;, :value &quot;05&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That means we can build an ‘alias’ system, taking arbitrary collections of identifiers and expanding/denormalising into all of the registered codesystems we know. In a real implementation, we’d recursively expand identifiers so we could alias all equivalent identifiers.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expand-identifier&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Determine the equivalent identifiers for the specified identifier tuple&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hash-map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;flatten&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;conj&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;vals&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So let’s check it works. Here we expand a single identifier tuple:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand-identifier&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;05&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;;  =&amp;gt; {&quot;https://snomed.info/sct&quot; 1077251000000100, &quot;https://data.standards.cymru/Id/datasets/edss/triage&quot; &quot;05&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And we can send in arbitrary identifiers which will be ignored if there are no expansions&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;This won't be mapped&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;05&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/other&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;N/A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expand-identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; =&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;{&quot;https://snomed.info/sct&quot; 1077251000000100,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; :name &quot;This won't be mapped&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; &quot;https://data.standards.cymru/Id/datasets/edss/triage&quot; &quot;05&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; &quot;https://data.standards.cymru/Id/datasets/edss/other&quot; &quot;N/A&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we can use these functions to build maps between arbitrary value sets in both classification and terminology systems - we could add an arbitrary map to another terminology or classification&lt;/p&gt;

&lt;h1 id=&quot;what-about-hl7-fhir-and-openehr&quot;&gt;What about HL7 FHIR and openEHR?&lt;/h1&gt;

&lt;p&gt;But look! We have triage models defined by both HL7 FHIR and openEHR.&lt;/p&gt;

&lt;p&gt;One approach is to try to centralise all of the definitions in one place. That’s a seductive approach, but brittle and difficult to change. It makes it harder in the future because you need a central authority to manage and curate. It’s much better to built a dynamic registry to which multiple code systems can register independently. It’s important to decouple at a technical level. That registry could be a small microservice that provides identifier mapping, semantics and inference, but that registrations at that registry can be made by multiple teams who don’t necessarily need to coordinate.&lt;/p&gt;

&lt;p&gt;An openEHR triage archetype is available at &lt;a href=&quot;https://ckm.openehr.org/ckm/archetypes/1013.1.304&quot;&gt;https://ckm.openehr.org/ckm/archetypes/1013.1.304&lt;/a&gt; but the data item is free-text! So much for semantic interoperability! This archetype is no good for our purposes.&lt;/p&gt;

&lt;p&gt;Fortunately, openEHR could support defining a value set either internally, or using a codeable concept. But this illustrates an important problem of openEHR; you still need to agree on a set of archetypes that will be used across your organisations and software systems if you are going to have semantic interoperability. It isn’t a magic bullet.&lt;/p&gt;

&lt;p&gt;The HL7 FHIR categories are &lt;a href=&quot;https://hl7.org/fhir/STU3/v3/ActPriority/vs.html&quot;&gt;https://hl7.org/fhir/STU3/v3/ActPriority/vs.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The nice thing about both openEHR and HL7 FHIR is that we can get definitions in machine-readable formats. We can therefore write tools that import and register those value-sets.&lt;/p&gt;

&lt;p&gt;The HL7 FHIR value set is defined under the namespace &lt;code class=&quot;highlighter-rouge&quot;&gt;http://hl7.org/fhir/ValueSet/v3-ActPriority&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;In this simple proof-of-concept, let’s register the equivalence of the semantics manually. In a real-life application, we’d download the HL7 FHIR definitions in machine-readable formats and process accordingly in our inference engine.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reg-equiv&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://hl7.org/fhir/v3/ActPriority&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;UR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;03&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now that means we can take FHIR identifiers and turn them into what we need. Notice we turn a FHIR ‘UR’ code into an NHS Wales emergency triage “03” code.&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand-identifier&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://hl7.org/fhir/v3/ActPriority&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;UR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; =&amp;gt; {&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot; &quot;03&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;;     &quot;http://hl7.org/fhir/v3/ActPriority&quot; &quot;UR&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can do it in reverse as part of a collection of different identifiers:&lt;/p&gt;

&lt;div class=&quot;language-clojure highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                                  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;This won't be mapped&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/triage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;03&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                     &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://data.standards.cymru/Id/datasets/edss/other&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;N/A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expand-identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;; =&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;{&quot;https://snomed.info/sct&quot; 1064901000000108,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; :name &quot;This won't be mapped&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; &quot;https://data.standards.cymru/Id/datasets/edss/triage&quot; &quot;03&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; &quot;http://hl7.org/fhir/v3/ActPriority&quot; &quot;UR&quot;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; &quot;https://data.standards.cymru/Id/datasets/edss/other&quot; &quot;N/A&quot;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that means we can now do logic such as asking, was this an urgent category and it doesn’t matter whether the information is encoded in SNOMED CT, the NHS Wales information standard or HL7 FHIR.&lt;/p&gt;

&lt;p&gt;It should be no surprise that we can do the same for cross-border interoperability. The &lt;a href=&quot;https://www.datadictionary.nhs.uk/data_dictionary/attributes/a/a_and_e_initial_assessment_triage_category_de.asp?shownav=1&quot;&gt;NHS England data dictionary&lt;/a&gt; has the same triage categories, except code “06” (See and Treat). We can either work to share definitions and therefore share the same namespace, or instead provide a declarative map from which the logic of mapping can be encoded and used by machines. If the namespace is shared, then coordination will be necessary so that “06” isn’t accidentally re-used for a semantically different triage category. If different namespaces are used, no coordination would be necessary except in tracking a declarative map from one to another.&lt;/p&gt;

&lt;p&gt;I’ve built mapping between SNOMED CT, ICD-10, Read codes and other codesystems in my own &lt;a href=&quot;https://github.com/wardle/go-terminology&quot;&gt;terminology server, written in golang&lt;/a&gt;. My real version of the Janus tool uses that to drive inferential logic using SNOMED as the lingua franca.&lt;/p&gt;

&lt;p&gt;My next step is to explore the use of off-the-shelf ontology tools to see whether they have the right performance and scaling characteristics to handle such a large ontology.&lt;/p&gt;

&lt;p&gt;For NHS Wales, we need to publish our information standards in machine-readable formats, adopt namespaces for our value sets and publish maps to those classifications from operational terminology systems.&lt;/p&gt;

&lt;h1 id=&quot;learning-points&quot;&gt;Learning points:&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;We need to namespace identifiers used for central reporting to give them &lt;em&gt;meaning&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;We need to publish datasets and category definitions in machine-readable formats so that they can be processed&lt;/li&gt;
  &lt;li&gt;We need to publish a declarative mapping from one identifier namespace to another if we wish to foster semantic interoperability; an ontology of ontologies.&lt;/li&gt;
  &lt;li&gt;Clojure (and other lisps) are really nice for doing exploratory programming using data.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">One of the difficulties with building semantic interoperability between clinical systems is how we define value sets.</summary></entry><entry><title type="html">PatientCare EPR</title><link href="https://www.wardle.org/patientcare/2020/06/26/patientcare-epr.html" rel="alternate" type="text/html" title="PatientCare EPR" /><published>2020-06-26T09:09:10+01:00</published><updated>2020-06-26T09:09:10+01:00</updated><id>https://www.wardle.org/patientcare/2020/06/26/patientcare-epr</id><content type="html" xml:base="https://www.wardle.org/patientcare/2020/06/26/patientcare-epr.html">&lt;p&gt;So I wrote an electronic health record, running live since 2009, and while it’s still not perfect, it’s had a lot of use and I’ve made a lot of changes.&lt;/p&gt;

&lt;p&gt;I wrote it in my spare time.&lt;/p&gt;

&lt;p&gt;Here are the statistics as of 24th June 2020:&lt;/p&gt;

&lt;p&gt;There are 34,587 registered patients from across Wales, with 36% living Cardiff and Vale University Health Board, 15.9% Aneurin Bevan University Health Board, 11.3% Swansea Bay Health Board, 7.5% Cwm Taf University Health Board and the remaining distributed across Hywel Dda, Betsi Cadwaladr, Powys University Health Boards and NHS England sites.&lt;/p&gt;

&lt;p&gt;There are 111 defined patient cohorts, with 78 NHS cohorts and 32 research cohorts and 577 health professionals registered to use the system including 81 specialist nurses, 78 administrators, 75 consultants, 63 physiotherapists, 52 doctors-in-training, 34 speech and language therapists, 30 occupational therapists, 25 dieticians and 10 psychologists, with the remaining comprising research associates, administrators and students.&lt;/p&gt;

&lt;p&gt;There have been 436,145 clinical encounters recorded using the software with usage increasing during the COVID-19 crisis to record patient clinical and research contacts. Of these, there have been 175,144 telephone calls, 116,977 outpatient clinic assessments, 91,854 virtual encounters, 17,504 home visits,  11,234 inpatient encounters, 7639 multi-disciplinary team assessments and 5891 therapy group encounters. There are 4843 electronic consent forms recorded.&lt;/p&gt;

&lt;p&gt;It integrates with the NHS Wales enterprise master patient index, the NHS Wales Care Record Service, the Cardiff and Vale document repository, the staff directory, multiple patient administrative systems and uses NHS systems for staff authentication.&lt;/p&gt;

&lt;p&gt;It is founded on structured meaningful data. All patients have a list of addresses and each address is mapped to health organisation and LSOA and so from there, indices of deprivation. Each patient has a list of diagnoses and problems and treatments. Each patient is linked to multiple health boards but users don’t think in terms of organisations, only services, which can span multiple health and care organisations. At any time, we can view disease progression, by whatever outcome measure, against a cohort of patients with the same disease or defined by other shared characteristics such as age, gender, age at onset etc. It was easy to identify all of our patients with, for example, motor neurone disease, who might need to ‘shield’ from COVID-19; a three-click operation.&lt;/p&gt;

&lt;p&gt;Over 6000 clinical or research encounters are recorded each month.&lt;/p&gt;

&lt;p&gt;Now I’m re-building it, there’s a lot I’m doing differently but the fundamentals stay the same.&lt;/p&gt;

&lt;p&gt;The important things?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Data data data&lt;/li&gt;
  &lt;li&gt;Declarative programming with rule-engine&lt;/li&gt;
  &lt;li&gt;Clean architecture&lt;/li&gt;
  &lt;li&gt;Separation of concerns&lt;/li&gt;
  &lt;li&gt;Decoupling&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">So I wrote an electronic health record, running live since 2009, and while it’s still not perfect, it’s had a lot of use and I’ve made a lot of changes.</summary></entry><entry><title type="html">‘Success’ in digital</title><link href="https://www.wardle.org/strategy/2020/06/23/success-in-digital.html" rel="alternate" type="text/html" title="'Success' in digital" /><published>2020-06-23T16:15:15+01:00</published><updated>2020-06-23T16:15:15+01:00</updated><id>https://www.wardle.org/strategy/2020/06/23/success-in-digital</id><content type="html" xml:base="https://www.wardle.org/strategy/2020/06/23/success-in-digital.html">&lt;p&gt;There has been some really good work in digital health and care in response to the COVID-19 crisis in Wales.&lt;/p&gt;

&lt;p&gt;What have been the characteristics of these successes? They have:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;focused on delivering solutions to immediate needs&lt;/li&gt;
  &lt;li&gt;broken down historic barriers&lt;/li&gt;
  &lt;li&gt;used commodity cloud services&lt;/li&gt;
  &lt;li&gt;leveraged commodity technologies such as video&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;And it’s really important to recognise this good work but we also need to see that most of this work has been, what are essentially, greenfield developments.&lt;/p&gt;

&lt;p&gt;And that tells you something interesting, because if you enable a culture, and a technology platform, that allows things to be developed as independently as possible - &lt;em&gt;decoupling&lt;/em&gt;, then it’s like giving a nitro-boost to your digital productivity.&lt;/p&gt;

&lt;p&gt;Our next challenge is to see how we can use those same approaches for brownfield developments, paying down technical debt and re-focusing our technical architecture on data and standards.&lt;/p&gt;

&lt;p&gt;There’s a paradox here. People who know little about technology and software think it makes sense to centralise and manage through command and control. It’s a seductive approach, but it doesn’t work. Let’s do it “once-for-Wales” they say, as if technology wasn’t a complex, multi-faceted intervention in a complex adaptive system. One size truly doesn’t fit all.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/one-size-doesnt-fit-all.jpg&quot; alt=&quot;One Size Doesnt Fit All&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;by Simon Wardley, &lt;a href=&quot;https://twitter.com/swardley/status/1275335953788342272?s=21&quot;&gt;No One Size Fits All&lt;/a&gt;. Also see &lt;a href=&quot;https://medium.com/wardleymaps/on-being-lost-2ef5f05eb1ec&quot;&gt;Wardley maps&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;transparency&quot;&gt;Transparency&lt;/h1&gt;

&lt;p&gt;But my biggest concern?&lt;/p&gt;

&lt;p&gt;That while here in Wales we have an amazing mix of people, skills and capabilities, we’re not working as openly and transparently as we should, and we’re not fostering healthy discussion and debate.&lt;/p&gt;

&lt;p&gt;We work for the public sector, and that means being open and transparent.&lt;/p&gt;

&lt;p&gt;Wales can and should be the best place to do health and care technology. But late in 2018, at a national clinical informatics meeting, I was told that I could no longer work for the NHS Wales Informatics Service unless I took down this blog, because it was deemed critical of the status quo (*).&lt;/p&gt;

&lt;p&gt;But we &lt;em&gt;need&lt;/em&gt; to be critical because we need to keep on improving for the people of Wales, and having insight into when we’re doing well and when we’re not, is critical in order to improve.&lt;/p&gt;

&lt;p&gt;So in light of that, while the NHS Wales Technical Standards Board has been furloughed, albeit temporarily, have a look at our &lt;a href=&quot;https://github.com/orgs/nhscymru/projects&quot;&gt;project list&lt;/a&gt; and raise &lt;a href=&quot;https://github.com/nhscymru/standards/issues&quot;&gt;an issue&lt;/a&gt;, and start a debate. The website is open. Its source code is open. Anyone can contribute. Tell me, what should we be doing next?&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mark&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;(*) I no longer work for the NHS Wales Informatics Service. The “funding ran out”.&lt;/p&gt;</content><author><name></name></author><summary type="html">There has been some really good work in digital health and care in response to the COVID-19 crisis in Wales.</summary></entry></feed>